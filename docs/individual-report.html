<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Final Individual Report: Kitchen safety and the Economy – Projects</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5657dfa6c17a855b02079790714f0f49.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.34.0/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Projects</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./netflix.html"> 
<span class="menu-text">Netflix</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./housing.html"> 
<span class="menu-text">Housing</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./nytrees.html"> 
<span class="menu-text">NYC Trees</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./facts.html"> 
<span class="menu-text">Fact Checking</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./individual-report.html" aria-current="page"> 
<span class="menu-text">Individual Report for Group Project</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#setup-and-cleaning" id="toc-setup-and-cleaning" class="nav-link" data-scroll-target="#setup-and-cleaning">Setup and Cleaning</a></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</a></li>
  <li><a href="#model-building-and-validation" id="toc-model-building-and-validation" class="nav-link" data-scroll-target="#model-building-and-validation">Model building and Validation</a>
  <ul class="collapse">
  <li><a href="#initial-modeling" id="toc-initial-modeling" class="nav-link" data-scroll-target="#initial-modeling">Initial Modeling</a></li>
  <li><a href="#further-modeling-and-validation" id="toc-further-modeling-and-validation" class="nav-link" data-scroll-target="#further-modeling-and-validation">Further Modeling and Validation</a></li>
  <li><a href="#plotting-the-model" id="toc-plotting-the-model" class="nav-link" data-scroll-target="#plotting-the-model">Plotting the Model</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  <li><a href="#potential-next-steps" id="toc-potential-next-steps" class="nav-link" data-scroll-target="#potential-next-steps">Potential Next steps</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Final Individual Report: Kitchen safety and the Economy</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This project was completed by four members including myself. We aimed to answer how restaurant quality relates to community health across NYC neighborhoods. In order to explore every aspect of this question, it was split into four parts for each member. I was tasked with asking the question: <strong><em>How do lower economic indicators correlate with inspection grades given to restaurants?</em></strong> To answer this question, I pulled some data and went through an in-depth analysis on how impactful some economic indicators can be on Food and Health safety.</p>
</section>
<section id="setup-and-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="setup-and-cleaning">Setup and Cleaning</h2>
<p>I will be using 2 of the 3 mentioned datasets in the project, NYC community health profiles and inspection results. There is no reason to include 311 sickness reports, as we are looking at the relation between economic indicators and grades in restaurants. Though, that is another question that could be looked at in the future.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl); <span class="fu">library</span>(tibble); <span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(ggplot2); <span class="fu">library</span>(reshape2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate); <span class="fu">library</span>(scales); <span class="fu">library</span>(janitor)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats); <span class="fu">library</span>(patchwork); <span class="fu">library</span>(scales)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT); <span class="fu">library</span>(glue); <span class="fu">library</span>(httr2); <span class="fu">library</span>(cowplot);</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr); <span class="fu">library</span>(diptest); <span class="fu">library</span>(kableExtra)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally);<span class="fu">library</span>(arm);<span class="fu">library</span>(broom);<span class="fu">library</span>(car)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conflicted);<span class="fu">library</span>(glmnet);<span class="fu">library</span>(lmtest); <span class="fu">library</span>(sandwich)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"select"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>recode)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>inspection_df <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">dest_dir      =</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"finproj"</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename      =</span> <span class="st">"dohmh_restaurant_inspections.csv"</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">force_refresh =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">guess_max     =</span> <span class="dv">100000</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">quiet_readr   =</span> <span class="cn">TRUE</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  src_url   <span class="ot">&lt;-</span> <span class="st">"https://data.cityofnewyork.us/api/views/43nn-pn8j/rows.csv?accessType=DOWNLOAD"</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  dest_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, filename)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dest_dir)) <span class="fu">dir.create</span>(dest_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  needs_download <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">file.exists</span>(dest_file) <span class="sc">||</span> <span class="fu">isTRUE</span>(force_refresh)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (needs_download) {</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">ifelse</span>(force_refresh, <span class="st">"Refreshing file: "</span>, <span class="st">"Downloading: "</span>), src_url)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> httr2<span class="sc">::</span><span class="fu">req_perform</span>(httr2<span class="sc">::</span><span class="fu">request</span>(src_url))</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    httr2<span class="sc">::</span><span class="fu">resp_check_status</span>(resp)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    raw <span class="ot">&lt;-</span> httr2<span class="sc">::</span><span class="fu">resp_body_raw</span>(resp)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".csv"</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">write_file</span>(raw, tmp)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.rename</span>(tmp, dest_file)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"File saved to: "</span>, dest_file)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"File already exists in destination: "</span>, dest_file)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(dest_file,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>                        <span class="at">guess_max =</span> guess_max,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                        <span class="at">show_col_types =</span> <span class="sc">!</span>quiet_readr)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"INSPECTION DATE"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    df[[<span class="st">"INSPECTION DATE"</span>]] <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lubridate<span class="sc">::</span><span class="fu">mdy</span>(df[[<span class="st">"INSPECTION DATE"</span>]]))</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"RECORD DATE"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    df[[<span class="st">"RECORD DATE"</span>]] <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lubridate<span class="sc">::</span><span class="fu">mdy</span>(df[[<span class="st">"RECORD DATE"</span>]]))</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>inspection<span class="ot">&lt;-</span> <span class="fu">inspection_df</span>()</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>community_health_df <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Source url and file names</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  src_url  <span class="ot">&lt;-</span> <span class="st">"https://www.nyc.gov/assets/doh/downloads/excel/episrv/2022-chp-pud.xlsx"</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  src_name <span class="ot">&lt;-</span> <span class="fu">basename</span>(src_url)  </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Destination paths</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  dest_dir  <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"finproj"</span>)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>  dest_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, src_name)</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dest_dir)) {</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dest_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(dest_file)) {</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Downloading: "</span>, src_url)</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    utils<span class="sc">::</span><span class="fu">download.file</span>(src_url, dest_file, <span class="at">mode =</span> <span class="st">"wb"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"File saved to: "</span>, dest_file)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"File already exists in destination: "</span>, dest_file)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(dest_file, <span class="at">sheet =</span> <span class="st">"CHP_all_data"</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">66</span><span class="sc">:</span><span class="dv">69</span>), ]</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>community_health<span class="ot">&lt;-</span><span class="fu">community_health_df</span>()</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>format_titles <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(<span class="fu">colnames</span>(df), <span class="st">"_"</span>, <span class="st">" "</span>) <span class="sc">|&gt;</span> <span class="fu">str_to_title</span>()</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>is_borough_level <span class="ot">&lt;-</span> community_health<span class="sc">$</span>ID <span class="sc">%in%</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a><span class="co">#Bourough rows</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>ch_boroughs <span class="ot">&lt;-</span> <span class="fu">subset</span>(community_health, is_borough_level)<span class="sc">|&gt;</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(ID<span class="sc">==</span><span class="st">"0"</span>))</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="co">#Community District rows</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>ch_neighbor <span class="ot">&lt;-</span> <span class="fu">subset</span>(community_health, <span class="sc">!</span>is_borough_level)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Now that we have setup the code, lets look at the economic indicators we will be using. The measure Rent Burden is classified as the percentage of renter-occupied homes whose gross rent is equal or greater than 30 percent of household income in the past 12 months. The measure unemployment is the Percentage of civilian labor force that are 16 and older, and unemployed. Finally, poverty is the percentage of residents living below 100% of New York City’s calculated poverty threshold based on income and necessary expenses. All of these are important indicators for how well people are doing financially each area. The idea is that if rent is expensive, unemployment is high, and/or poverty is high, people are less likely to buy food from restaurants. This in turn would lead restaurants to have less income to spend on food compliance and thus lower their grade on the next inspection. Below is a sample of the data we will be working with.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ch_neighbor<span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    Name,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    Poverty,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    Rent_Burden,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    Unemployment</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(Poverty, Rent_Burden, Unemployment),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="dv">1</span>)(.x)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_titles</span>()<span class="sc">|&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">20</span>)<span class="sc">|&gt;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">options=</span> <span class="fu">list</span>(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">pagelength=</span><span class="dv">5</span>, </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">lengthMenu =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-0ab5fa46c482514d73db" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0ab5fa46c482514d73db">{"x":{"filter":"none","vertical":false,"data":[["Rockaway and Broad Channel","Mott Haven and Melrose","Jackson Heights","Upper West Side","Bay Ridge and Dyker Heights","Morris Park and Bronxdale","Greenpoint and Williamsburg","Riverdale and Fieldston","Fordham and University Heights","Brownsville","Borough Park","South Crown Heights and Lefferts Gardens","Stuyvesant Town and Turtle Bay","Belmont and East Tremont","Crown Heights and Prospect Heights","Ridgewood and Maspeth","Throgs Neck and Co-op City","Hunts Point and Longwood","South Beach and Willowbrook","Jamaica and Hollis"],["17.2%","31.5%","22.3%","9.5%","16.7%","19.9%","16.2%","18.6%","35.4%","28.5%","26.9%","20.5%","8.7%","30.9%","20.5%","15.4%","15.8%","31.5%","12.2%","16.9%"],["49.0%","58.0%","60.0%","36.0%","47.0%","56.0%","45.0%","52.0%","62.0%","60.0%","64.0%","51.0%","41.0%","58.0%","48.0%","45.0%","46.0%","58.0%","47.0%","52.0%"],["8.0%","12.0%","5.0%","4.0%","5.0%","9.0%","5.0%","7.0%","12.0%","12.0%","5.0%","7.0%","3.0%","13.0%","6.0%","4.0%","7.0%","12.0%","5.0%","8.0%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Name<\/th>\n      <th>Poverty<\/th>\n      <th>Rent Burden<\/th>\n      <th>Unemployment<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pagelength":5,"lengthMenu":[5,10,15,20],"columnDefs":[{"name":"Name","targets":0},{"name":"Poverty","targets":1},{"name":"Rent Burden","targets":2},{"name":"Unemployment","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>When looking at inspection data, I found that there were restaurants that were repeated multiple times, and on the same day. Not only this, but grades with Na’s and other letters (like N for “Not Yet Graded”) were present. This is because each individual violation is recorded and noted if it is critically important or not. While this would be helpful for answering other questions in this project like the amount of critical flags in a district, it isn’t here. Having repeats of the same grade and non-grading letters can drastically warp our findings.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>inspection<span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()<span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_dupes</span>(camis, inspection_date)<span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(grade))<span class="sc">|&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">30</span>)<span class="sc">|&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">name=</span>dba, critical_flag, inspection_date, grade)<span class="sc">|&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_titles</span>()<span class="sc">|&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">options=</span> <span class="fu">list</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">pagelength=</span><span class="dv">5</span>, </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">lengthMenu =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8e5f28d9b81ecd32e5e4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8e5f28d9b81ecd32e5e4">{"x":{"filter":"none","vertical":false,"data":[["NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","NEW YOBAO BEEF BURGER","KLOUD","KLOUD","KLOUD","KLOUD","KLOUD","KLOUD","KLOUD","KLOUD","KLOUD","KLOUD","VIBE 592 BAR &amp; BISTRO","VIBE 592 BAR &amp; BISTRO","VIBE 592 BAR &amp; BISTRO","VIBE 592 BAR &amp; BISTRO","VIBE 592 BAR &amp; BISTRO","VIBE 592 BAR &amp; BISTRO","VIBE 592 BAR &amp; BISTRO","VIBE 592 BAR &amp; BISTRO"],["Not Critical","Not Critical","Not Critical","Not Critical","Critical","Critical","Not Critical","Critical","Critical","Critical","Not Critical","Critical","Not Critical","Not Critical","Not Critical","Critical","Critical","Not Critical","Critical","Not Critical","Critical","Critical","Not Critical","Not Critical","Critical","Not Critical","Critical","Critical","Not Critical","Not Critical"],["2025-11-03","2025-11-03","2025-11-03","2025-11-03","2025-11-03","2025-11-03","2025-11-03","2025-11-03","2025-11-03","2025-11-03","2025-11-03","2025-11-03","2025-12-03","2025-12-03","2025-12-03","2025-12-03","2025-12-03","2025-12-03","2025-12-03","2025-12-03","2025-12-03","2025-12-03","2025-12-13","2025-12-13","2025-12-13","2025-12-13","2025-12-13","2025-12-13","2025-12-13","2025-12-13"],["N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Name<\/th>\n      <th>Critical Flag<\/th>\n      <th>Inspection Date<\/th>\n      <th>Grade<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pagelength":5,"lengthMenu":[5,10,15,20],"columnDefs":[{"name":"Name","targets":0},{"name":"Critical Flag","targets":1},{"name":"Inspection Date","targets":2},{"name":"Grade","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>To make sure this dataset can join with community health, we added district/neighborhood groups based on the zip code. Mutating to an ID and joining it is definitely the optimal and safe option, but the amount of rows in the community health dataset is relatively small. This means we can copy the exact name of the area from the dataset and put it in this code. Now that the data is cleaned, we can move on to the next step.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>inspection_cleaned <span class="ot">&lt;-</span> inspection <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()<span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">neighborhood_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10031</span>, <span class="dv">10032</span>, <span class="dv">10033</span>, <span class="dv">10034</span>, <span class="dv">10040</span>) <span class="sc">~</span> <span class="st">"Washington Heights and Inwood"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10026</span>, <span class="dv">10030</span>, <span class="dv">10037</span>, <span class="dv">10039</span>) <span class="sc">~</span> <span class="st">"Central Harlem"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10029</span>, <span class="dv">10035</span>) <span class="sc">~</span> <span class="st">"East Harlem"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10023</span>, <span class="dv">10024</span>) <span class="sc">~</span> <span class="st">"Upper West Side"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10021</span>, <span class="dv">10028</span>, <span class="dv">10044</span>, <span class="dv">10065</span>, <span class="dv">10075</span>, <span class="dv">10128</span>) <span class="sc">~</span> <span class="st">"Upper East Side"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10001</span>, <span class="dv">10011</span>, <span class="dv">10018</span>, <span class="dv">10019</span>, <span class="dv">10020</span>, <span class="dv">10036</span>) <span class="sc">~</span> <span class="st">"Clinton and Chelsea"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10010</span>, <span class="dv">10016</span>, <span class="dv">10017</span>, <span class="dv">10022</span>) <span class="sc">~</span> <span class="st">"Stuyvesant Town and Turtle Bay"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10012</span>, <span class="dv">10013</span>, <span class="dv">10014</span>) <span class="sc">~</span> <span class="st">"Greenwich Village and Soho"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10002</span>, <span class="dv">10003</span>, <span class="dv">10009</span>) <span class="sc">~</span> <span class="st">"Lower East Side and Chinatown"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10004</span>, <span class="dv">10005</span>, <span class="dv">10006</span>, <span class="dv">10007</span>, <span class="dv">10038</span>, <span class="dv">10280</span>) <span class="sc">~</span> <span class="st">"Financial District"</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10025</span>, <span class="dv">10027</span>) <span class="sc">~</span> <span class="st">"Morningside Heights and Hamilton Heights"</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10301</span>, <span class="dv">10302</span>, <span class="dv">10303</span>, <span class="dv">10304</span>, <span class="dv">10305</span>, <span class="dv">10310</span>) <span class="sc">~</span> <span class="st">"St. George and Stapleton"</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10306</span>, <span class="dv">10314</span>) <span class="sc">~</span> <span class="st">"South Beach and Willowbrook"</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10307</span>, <span class="dv">10308</span>, <span class="dv">10309</span>, <span class="dv">10312</span>) <span class="sc">~</span> <span class="st">"Tottenville and Great Kills"</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10451</span>, <span class="dv">10454</span>, <span class="dv">10455</span>, <span class="dv">10456</span>, <span class="dv">10459</span>) <span class="sc">~</span> <span class="st">"Mott Haven and Melrose"</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10474</span>, <span class="dv">10475</span>) <span class="sc">~</span> <span class="st">"Hunts Point and Longwood"</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10453</span>, <span class="dv">10457</span>, <span class="dv">10458</span>, <span class="dv">10460</span>) <span class="sc">~</span> <span class="st">"Morrisania and Crotona"</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10452</span>, <span class="dv">10456</span>, <span class="dv">10451</span>) <span class="sc">~</span> <span class="st">"Highbridge and Concourse"</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10453</span>, <span class="dv">10458</span>, <span class="dv">10467</span>, <span class="dv">10468</span>) <span class="sc">~</span> <span class="st">"Fordham and University Heights"</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10457</span>, <span class="dv">10458</span>, <span class="dv">10461</span>) <span class="sc">~</span> <span class="st">"Belmont and East Tremont"</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10463</span>, <span class="dv">10471</span>) <span class="sc">~</span> <span class="st">"Kingsbridge Heights and Bedford"</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10463</span>, <span class="dv">10471</span>) <span class="sc">~</span> <span class="st">"Riverdale and Fieldston"</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10462</span>, <span class="dv">10473</span>) <span class="sc">~</span> <span class="st">"Parkchester and Soundview"</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10461</span>, <span class="dv">10465</span>, <span class="dv">10472</span>, <span class="dv">10473</span>) <span class="sc">~</span> <span class="st">"Throgs Neck and Co-op City"</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10461</span>, <span class="dv">10462</span>) <span class="sc">~</span> <span class="st">"Morris Park and Bronxdale"</span>,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10466</span>, <span class="dv">10467</span>, <span class="dv">10469</span>) <span class="sc">~</span> <span class="st">"Williamsbridge and Baychester"</span>,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11211</span>, <span class="dv">11222</span>) <span class="sc">~</span> <span class="st">"Greenpoint and Williamsburg"</span>,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11201</span>, <span class="dv">11205</span>) <span class="sc">~</span> <span class="st">"Fort Greene and Brooklyn Heights"</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11206</span>, <span class="dv">11216</span>, <span class="dv">11221</span>, <span class="dv">11233</span>, <span class="dv">11238</span>) <span class="sc">~</span> <span class="st">"Bedford Stuyvesant"</span>,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11207</span>, <span class="dv">11221</span>, <span class="dv">11237</span>) <span class="sc">~</span> <span class="st">"Bushwick"</span>,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11207</span>, <span class="dv">11208</span>) <span class="sc">~</span> <span class="st">"East New York and Starrett City"</span>,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11215</span>, <span class="dv">11217</span>, <span class="dv">11231</span>) <span class="sc">~</span> <span class="st">"Park Slope and Carroll Gardens"</span>,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11220</span>, <span class="dv">11232</span>) <span class="sc">~</span> <span class="st">"Sunset Park"</span>,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11213</span>, <span class="dv">11216</span>, <span class="dv">11225</span>, <span class="dv">11238</span>) <span class="sc">~</span> <span class="st">"Crown Heights and Prospect Heights"</span>,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11203</span>, <span class="dv">11212</span>) <span class="sc">~</span> <span class="st">"South Crown Heights and Lefferts Gardens"</span>,</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11209</span>, <span class="dv">11220</span>) <span class="sc">~</span> <span class="st">"Bay Ridge and Dyker Heights"</span>,</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11204</span>, <span class="dv">11214</span>, <span class="dv">11228</span>) <span class="sc">~</span> <span class="st">"Bensonhurst"</span>,</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11204</span>, <span class="dv">11218</span>, <span class="dv">11219</span>, <span class="dv">11230</span>) <span class="sc">~</span> <span class="st">"borough Park"</span>,</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11224</span>) <span class="sc">~</span> <span class="st">"Coney Island"</span>,</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11203</span>, <span class="dv">11210</span>, <span class="dv">11226</span>) <span class="sc">~</span> <span class="st">"Flatbush and Midwood"</span>,</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11235</span>) <span class="sc">~</span> <span class="st">"Sheepshead Bay"</span>,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11212</span>, <span class="dv">11233</span>) <span class="sc">~</span> <span class="st">"Brownsville"</span>,</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11203</span>, <span class="dv">11226</span>, <span class="dv">11230</span>) <span class="sc">~</span> <span class="st">"East Flatbush"</span>,</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11236</span>, <span class="dv">11234</span>) <span class="sc">~</span> <span class="st">"Flatlands and Canarsie"</span>,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11101</span>, <span class="dv">11102</span>, <span class="dv">11103</span>, <span class="dv">11104</span>, <span class="dv">11105</span>, <span class="dv">11106</span>, <span class="dv">11369</span>, <span class="dv">11370</span>, <span class="dv">11377</span>) <span class="sc">~</span> <span class="st">"Long Island City and Astoria"</span>,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11377</span>, <span class="dv">11378</span>, <span class="dv">11379</span>) <span class="sc">~</span> <span class="st">"Woodside and Sunnyside"</span>,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11372</span>, <span class="dv">11373</span>, <span class="dv">11374</span>) <span class="sc">~</span> <span class="st">"Jackson Heights"</span>,</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11373</span>, <span class="dv">11375</span>, <span class="dv">11368</span>) <span class="sc">~</span> <span class="st">"Elmhurst and Corona"</span>,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11385</span>, <span class="dv">11378</span>) <span class="sc">~</span> <span class="st">"Ridgewood and Maspeth"</span>,</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11374</span>, <span class="dv">11375</span>, <span class="dv">11385</span>) <span class="sc">~</span> <span class="st">"Rego Park and Forest Hills"</span>,</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11354</span>, <span class="dv">11355</span>, <span class="dv">11356</span>, <span class="dv">11357</span>, <span class="dv">11358</span>) <span class="sc">~</span> <span class="st">"Flushing and Whitestone"</span>,</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11365</span>, <span class="dv">11366</span>, <span class="dv">11367</span>) <span class="sc">~</span> <span class="st">"Hillcrest and Fresh Meadows"</span>,</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11415</span>, <span class="dv">11416</span>, <span class="dv">11421</span>) <span class="sc">~</span> <span class="st">"Kew Gardens and Woodhaven"</span>,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11417</span>, <span class="dv">11419</span>, <span class="dv">11420</span>) <span class="sc">~</span> <span class="st">"South Ozone Park and Howard Beach"</span>,</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11360</span>, <span class="dv">11361</span>, <span class="dv">11362</span>) <span class="sc">~</span> <span class="st">"Bayside and Little Neck"</span>,</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11412</span>, <span class="dv">11423</span>, <span class="dv">11432</span>, <span class="dv">11433</span>, <span class="dv">11434</span>) <span class="sc">~</span> <span class="st">"Jamaica and Hollis"</span>,</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11427</span>, <span class="dv">11428</span>, <span class="dv">11429</span>) <span class="sc">~</span> <span class="st">"Queens Village"</span>,</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11691</span>, <span class="dv">11692</span>, <span class="dv">11693</span>, <span class="dv">11694</span>, <span class="dv">11695</span>) <span class="sc">~</span> <span class="st">"Rockaway and Broad Channel"</span>,</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="fu">pick</span>(camis, inspection_date), <span class="at">.keep_all=</span><span class="cn">TRUE</span>)<span class="sc">|&gt;</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>), <span class="fu">year</span>(inspection_date)<span class="sc">&gt;=</span> <span class="dv">2021</span> </span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>         <span class="sc">&amp;</span> <span class="fu">year</span>(inspection_date)<span class="sc">&lt;=</span> <span class="dv">2025</span> )<span class="sc">|&gt;</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inspection_date=</span> <span class="fu">as.Date</span>(inspection_date, <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">grade_date=</span> <span class="fu">as.Date</span>(inspection_date, <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>)</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>ch_neighbor<span class="ot">&lt;-</span> ch_neighbor<span class="sc">|&gt;</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), <span class="sc">~</span> <span class="fu">na_if</span>(., <span class="st">"n/a"</span>)))<span class="sc">|&gt;</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> inspection_cleaned<span class="sc">|&gt;</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ch_neighbor, </span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"neighborhood_group"</span> <span class="ot">=</span> <span class="st">"name"</span>))<span class="sc">|&gt;</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">name=</span>neighborhood_group)<span class="sc">|&gt;</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>    name, id,</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>    poverty, unemployment, rent_burden,</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>    grade, score, grade_date,</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>    inspection_date,borough)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I also separated IDs 0-5 from community_health, those IDs specifically show borough and city wide data. It might be used later, so it is split into a separate dataset for now.</p>
</div>
</div>
</section>
<section id="exploratory-data-analysis-eda" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</h2>
<p>I began with some exploratory data analysis to understand the socioeconomic indicators at the district level. I gave histograms a mean reference line to assess the central tendency, spread, and skewedness of the data. There is some moderate variation in poverty and rent burden, and a right skewedness in unemployment. Unemployment also is the only one that has an outlier in the box plot, being around 13%.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ch_plot <span class="ot">&lt;-</span> ch_neighbor <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), <span class="sc">~</span> <span class="fu">na_if</span>(.x, <span class="st">"n/a"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(poverty,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>         rent_burden,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         unemployment) <span class="sc">|&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_titles</span>()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>indicators <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Poverty"</span>,<span class="st">"Rent Burden"</span>,<span class="st">"Unemployment"</span> )</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>plot_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(indicators, <span class="cf">function</span>(v) {</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  bw <span class="ot">&lt;-</span> <span class="cf">if</span> (v <span class="sc">==</span> <span class="st">"Unemployment"</span>) <span class="dv">1</span> <span class="cf">else</span> <span class="dv">2</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(ch_plot, <span class="fu">aes</span>(<span class="at">x =</span> .data[[v]])) <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> bw, <span class="at">fill =</span> <span class="st">"#4E79A7"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(.data[[v]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> v, <span class="at">x =</span> <span class="st">"%"</span>, <span class="at">y =</span> <span class="st">"Districts"</span>) <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>plot_list2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(indicators, <span class="cf">function</span>(v) {</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(ch_plot, <span class="fu">aes</span>(<span class="at">x =</span> .data[[v]])) <span class="sc">+</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"#4E79A7"</span>) <span class="sc">+</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> v, <span class="at">x =</span> <span class="st">"%"</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(plot_list, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(plot_list2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="individual-report_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="individual-report_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Rent burden and unemployment did not look unimodal, so to see if they are unimodal I conducted the Hartigan’s Dip test. It indicated poverty and rent burden are consistent with unimodal distributions. However, Unemployment’s test is significant, meaning it indicates significant bimodality. This is likely because of the few districts with a high unemployment rate. I also wanted to use density plots to check if these indicators have similar shapes or different patterns, which can help with deciding a good fitting model. Again, Unemployment seems to re-occur with skewedness and a decently heavy tail, causing this unimodality.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>long <span class="ot">&lt;-</span> ch_plot <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Poverty, <span class="st">`</span><span class="at">Rent Burden</span><span class="st">`</span>, Unemployment),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">"indicator"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> long <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(indicator) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> <span class="fu">dip.test</span>(value[<span class="sc">!</span><span class="fu">is.na</span>(value)])<span class="sc">$</span>p.value,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(p_value)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>long<span class="sc">|&gt;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(value, <span class="at">fill =</span> indicator)) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">adjust =</span> <span class="fl">1.0</span>) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"%"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)<span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="individual-report_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>res<span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">5</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Indicator"</span>, <span class="st">"Dip test p-value"</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.attr =</span> <span class="st">"style='width:420px; margin-left:auto; margin-right:auto;'"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">position =</span> <span class="st">"center"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"condensed"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-condensed caption-top table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Indicator</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Dip test p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Unemployment</td>
<td style="text-align: center;">0.00029</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rent Burden</td>
<td style="text-align: center;">0.41125</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Poverty</td>
<td style="text-align: center;">0.98757</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>table.table {   width: auto !important;   margin-left: auto;   margin-right: auto; }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Finally, I wanted to test if there was a correlation between these three variables. This is important because if the predictors have low/moderate correlation, a model with these variables could be more accurate. But if they are too high, these correlations could make the coefficients unstable and the model unreliable. Looking at the pair plots, rent burden and unemployment have the lowest correlation, but still moderately high at 0.62. All three pairs have upward trends, and the cloud of points are fairly linear with some spread.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  ch_plot,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Poverty"</span>,<span class="st">"Rent Burden"</span>,<span class="st">"Unemployment"</span>),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> GGally<span class="sc">::</span><span class="fu">wrap</span>(<span class="st">"cor"</span>, <span class="at">size =</span> <span class="dv">4</span>)),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> GGally<span class="sc">::</span><span class="fu">wrap</span>(<span class="st">"points"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">1.8</span>)),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag  =</span> <span class="fu">list</span>(<span class="at">continuous =</span> GGally<span class="sc">::</span><span class="fu">wrap</span>(<span class="st">"blankDiag"</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="individual-report_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-building-and-validation" class="level2">
<h2 class="anchored" data-anchor-id="model-building-and-validation">Model building and Validation</h2>
<section id="initial-modeling" class="level3">
<h3 class="anchored" data-anchor-id="initial-modeling">Initial Modeling</h3>
<p>The first model I tried was a single variable model for all 3 Grades (A, B, and C), using each socioeconomic variable on its own. While these simple linear regression fits are useful to see the general relationships, the indicators are moderately to highly correlated to each other. Its likely that rent burned, unemployment, and poverty each contribute signal to grade outcomes. Modeling them jointly or through a composite index would probably get the pattern more reliable than a single variable. Just to make sure, I began with simple scatter plots and gave regression lines by grade. Grade A’s given to restaurant generally decreases as economic stress increases, and grade B tends to rise. Grade c shows a smaller increase, but its much noisier.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>grades<span class="ot">&lt;-</span> combined_df<span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(inspection_date)<span class="sc">&gt;=</span> <span class="dv">2021</span> <span class="sc">&amp;</span> <span class="fu">year</span>(inspection_date)<span class="sc">&lt;=</span> <span class="dv">2025</span> )<span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id)<span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_restaurants =</span> <span class="fu">n</span>(),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade_A_count =</span> <span class="fu">sum</span>(grade <span class="sc">==</span> <span class="st">"A"</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade_B_count =</span> <span class="fu">sum</span>(grade <span class="sc">==</span> <span class="st">"B"</span>),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade_C_count =</span> <span class="fu">sum</span>(grade <span class="sc">==</span> <span class="st">"C"</span>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_score =</span> <span class="fu">mean</span>(score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(id))<span class="sc">|&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_grade_A =</span> grade_A_count <span class="sc">/</span> total_restaurants,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_grade_B =</span> grade_B_count <span class="sc">/</span> total_restaurants,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_grade_C =</span> grade_C_count <span class="sc">/</span> total_restaurants,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">nonA_count =</span> total_restaurants <span class="sc">-</span> grade_A_count</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(combined_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>))<span class="sc">|&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_z =</span> <span class="fu">scale</span>(rent_burden)[,<span class="dv">1</span>],</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">poverty_z     =</span> <span class="fu">scale</span>(poverty)[,<span class="dv">1</span>],</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">unemployment_z =</span> <span class="fu">scale</span>(unemployment)[,<span class="dv">1</span>]</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)<span class="sc">|&gt;</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>grade, <span class="sc">-</span> score, <span class="sc">-</span>grade_date)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>grades_long<span class="ot">&lt;-</span> grades <span class="sc">|&gt;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rent_burden, poverty, unemployment, pct_grade_A, pct_grade_B, pct_grade_C) <span class="sc">|&gt;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"pct_grade_"</span>),</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"grade"</span>,</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"pct"</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(grade,</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"pct_grade_A"</span> <span class="ot">=</span> <span class="st">"Grade A"</span>,</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"pct_grade_B"</span> <span class="ot">=</span> <span class="st">"Grade B"</span>,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"pct_grade_C"</span> <span class="ot">=</span> <span class="st">"Grade C"</span>)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>grades_long <span class="sc">|&gt;</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rent_burden, <span class="at">y =</span> pct)) <span class="sc">+</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden vs % Grade"</span>,</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"% Rent Burden"</span>,</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% of Grade"</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grade, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span>   </span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>grades_long <span class="sc">|&gt;</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> poverty, <span class="at">y=</span> pct))<span class="sc">+</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span><span class="st">"poverty vs % Grade "</span>, </span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% poverty"</span>, </span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"% of Grade"</span>)<span class="sc">+</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grade, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>grades_long <span class="sc">|&gt;</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> unemployment, <span class="at">y =</span> pct)) <span class="sc">+</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden vs % Grade"</span>,</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"% Rent Burden"</span>,</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% of Grade"</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grade, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span>   </span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="individual-report_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="individual-report_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="individual-report_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="further-modeling-and-validation" class="level3">
<h3 class="anchored" data-anchor-id="further-modeling-and-validation">Further Modeling and Validation</h3>
<p>decided to move on from single variables, so I constructed two citywide indices that summarize economic stress per district. The Equal weight Z index (EZI) standardizes each indicator to a z-score and averages them. A <strong>higher</strong> EZI essentially means <strong>more economic stress</strong> by an equal fraction of rent, poverty, and unemployment. I also built a Supervised Logistic Index (SLI) by fitting a binomial model for A versus non-A percentages on 3 z-scores, and used the coefficients as weights. Because SLI’s weights are chosen to best predict the outcome, it tends to be more predictive. The orientation is different however, a <strong>higher</strong> SLI leads to <strong>less economic stress</strong> and/or a <strong>higher predicted percentage</strong> <strong>of A’s</strong> because the direction is set by the learned weights.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|results: hold</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>district_metrics <span class="ot">&lt;-</span> ch_neighbor <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, rent_burden, poverty, unemployment) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_z =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(rent_burden)),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pov_z  =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(poverty)),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">un_z   =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(unemployment)),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">EZI    =</span> (rent_z <span class="sc">+</span> pov_z <span class="sc">+</span> un_z) <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">EZI_z  =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(EZI)),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">EZI_100 =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(EZI, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>df_idx <span class="ot">&lt;-</span> grades <span class="sc">|&gt;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    district_metrics <span class="sc">|&gt;</span> <span class="fu">select</span>(id, EZI_z, EZI_100, rent_z, pov_z, un_z),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"id"</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>m_sli_weights <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(grade_A_count, total_restaurants <span class="sc">-</span> grade_A_count) <span class="sc">~</span> rent_z <span class="sc">+</span> pov_z <span class="sc">+</span> un_z,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_idx, <span class="at">family =</span> binomial</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">coef</span>(m_sli_weights)[<span class="fu">c</span>(<span class="st">"rent_z"</span>,<span class="st">"pov_z"</span>,<span class="st">"un_z"</span>)]</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>df_idx <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">SLI_raw =</span> w[<span class="st">"rent_z"</span>]<span class="sc">*</span>rent_z <span class="sc">+</span> w[<span class="st">"pov_z"</span>]<span class="sc">*</span>pov_z <span class="sc">+</span> w[<span class="st">"un_z"</span>]<span class="sc">*</span>un_z,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">SLI_z   =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(SLI_raw)),</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">SLI_100 =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(SLI_raw, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>All grade models were fit as binomial GLMs using district‑level counts (e.g., <code>cbind(A_count, total – A_count)</code>), which weights by district size and yields predictions on the probability scale, the percentage of restaurants. For each grade, I estimated multiple things, the first being univariate models for rent, poverty, and unemployment and the second a multiple model with all three indicators. Finally, I estimated multiple index‑based models with EZI or SLI alone. I then compared fits using AIC and McFadden’s pseudo‑R² . The comparison table shows a fairly consistent pattern. For Grade A, the SLI and multiple models deliver the best performance (AIC around 514–518 and R² ≈ 0.46), substantially improving on the EZI model (AIC ≈ 559, R² ≈ 0.33) and far outperforming unemployment alone (AIC ≈ 637, R² ≈ 0.11). For Grade B, the multiple specification stands out with an of AIC ≈ 427 and R² ≈ 0.51. Rent and poverty univariates are close behind, while the index models trail but still have most of the effect. Grade C generally follows B’s pattern but again has a weaker signal and wider uncertainty, so I am uncertain if Grade C will have significance in any of these models.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fit_binom <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">grade =</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>), rhs) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  grade <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(grade)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  y_s <span class="ot">&lt;-</span> <span class="cf">switch</span>(grade,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">A =</span> df<span class="sc">$</span>grade_A_count,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">B =</span> df<span class="sc">$</span>grade_B_count,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">C =</span> df<span class="sc">$</span>grade_C_count)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  y_f <span class="ot">&lt;-</span> df<span class="sc">$</span>total_restaurants <span class="sc">-</span> y_s</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(<span class="fu">cbind</span>(y_s, y_f) <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">cbind.data.frame</span>(rhs, y_s, y_f),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictor sets</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>rhs_ezi   <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(EZI_z)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>rhs_sli   <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(SLI_z)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>rhs_uni_rb<span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(rent_z)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>rhs_uni_p <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(pov_z)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>rhs_uni_u <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(un_z)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>rhs_multi <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(rent_z, pov_z, un_z)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>mods <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_ezi   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_ezi),</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_sli   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_sli),</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_rb    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_uni_rb),</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_pov   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_uni_p),</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_un    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_uni_u),</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_multi =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_multi),</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_ezi   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_ezi),</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_sli   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_sli),</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_rb    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_uni_rb),</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_pov   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_uni_p),</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_un    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_uni_u),</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_multi =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_multi),</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_ezi   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_ezi),</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_sli   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_sli),</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_rb    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_uni_rb),</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_pov   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_uni_p),</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_un    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_uni_u),</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_multi =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_multi)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>pseudoR2 <span class="ot">&lt;-</span> <span class="cf">function</span>(m) <span class="dv">1</span> <span class="sc">-</span> (m<span class="sc">$</span>deviance <span class="sc">/</span> m<span class="sc">$</span>null.deviance)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">names</span>(mods),</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC   =</span> <span class="fu">sapply</span>(mods, AIC),</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">McFadden_R2 =</span> <span class="fu">sapply</span>(mods, pseudoR2)</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(model)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>model_summary<span class="ot">&lt;-</span> model_summary <span class="sc">|&gt;</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> <span class="fu">str_extract</span>(model, <span class="st">"^[ABC]"</span>),</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">spec  =</span> <span class="fu">str_replace</span>(model, <span class="st">"^[ABC]_"</span>,<span class="st">""</span>)</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> <span class="fu">recode</span>(grade,</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>      <span class="st">"A"</span> <span class="ot">=</span> <span class="st">"Grade A"</span>,</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>      <span class="st">"B"</span> <span class="ot">=</span> <span class="st">"Grade B"</span>,</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>      <span class="st">"C"</span> <span class="ot">=</span> <span class="st">"Grade C"</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">spec =</span> <span class="fu">recode</span>(spec,</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>      <span class="st">"ezi"</span>   <span class="ot">=</span> <span class="st">"EZI (equal‑weight index)"</span>,</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sli"</span>   <span class="ot">=</span> <span class="st">"SLI (supervised index)"</span>,</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>      <span class="st">"multi"</span> <span class="ot">=</span> <span class="st">"Multiple (rent + poverty + unemployment)"</span>,</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>      <span class="st">"rb"</span>    <span class="ot">=</span> <span class="st">"Rent burden only"</span>,</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pov"</span>   <span class="ot">=</span> <span class="st">"Poverty only"</span>,</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>      <span class="st">"un"</span>    <span class="ot">=</span> <span class="st">"Unemployment only"</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">|&gt;</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grade, spec, AIC, McFadden_R2) <span class="sc">|&gt;</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(grade, AIC)</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>aic_wide <span class="ot">&lt;-</span> model_summary <span class="sc">|&gt;</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grade, spec, AIC) <span class="sc">|&gt;</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> grade, <span class="at">values_from =</span> AIC)</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>r2_wide <span class="ot">&lt;-</span> model_summary <span class="sc">|&gt;</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grade, spec, McFadden_R2) <span class="sc">|&gt;</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> grade, <span class="at">values_from =</span> McFadden_R2)</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(aic_wide, <span class="at">caption =</span> <span class="st">"AIC Model comparison"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>))<span class="sc">|&gt;</span> </span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"condensed"</span>))</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(r2_wide, <span class="at">caption =</span> <span class="st">"McFadden R² Model comparison"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>))<span class="sc">|&gt;</span> </span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"condensed"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<caption>AIC Model comparison</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">spec</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Grade A</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Grade B</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Grade C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SLI (supervised index)</td>
<td style="text-align: right;">513.880</td>
<td style="text-align: right;">424.472</td>
<td style="text-align: right;">400.394</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: right;">517.880</td>
<td style="text-align: right;">427.306</td>
<td style="text-align: right;">402.250</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rent burden only</td>
<td style="text-align: right;">527.532</td>
<td style="text-align: right;">436.155</td>
<td style="text-align: right;">402.264</td>
</tr>
<tr class="even">
<td style="text-align: left;">Poverty only</td>
<td style="text-align: right;">552.162</td>
<td style="text-align: right;">444.832</td>
<td style="text-align: right;">413.409</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EZI (equal‑weight index)</td>
<td style="text-align: right;">559.131</td>
<td style="text-align: right;">453.594</td>
<td style="text-align: right;">412.842</td>
</tr>
<tr class="even">
<td style="text-align: left;">Unemployment only</td>
<td style="text-align: right;">636.541</td>
<td style="text-align: right;">514.149</td>
<td style="text-align: right;">426.617</td>
</tr>
</tbody>
</table>



<table class="table table-striped table-condensed caption-top table-sm small">
<caption>McFadden R² Model comparison</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">spec</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Grade A</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Grade B</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Grade C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SLI (supervised index)</td>
<td style="text-align: right;">0.457</td>
<td style="text-align: right;">0.510</td>
<td style="text-align: right;">0.187</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: right;">0.457</td>
<td style="text-align: right;">0.515</td>
<td style="text-align: right;">0.200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rent burden only</td>
<td style="text-align: right;">0.418</td>
<td style="text-align: right;">0.462</td>
<td style="text-align: right;">0.175</td>
</tr>
<tr class="even">
<td style="text-align: left;">Poverty only</td>
<td style="text-align: right;">0.348</td>
<td style="text-align: right;">0.427</td>
<td style="text-align: right;">0.106</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EZI (equal‑weight index)</td>
<td style="text-align: right;">0.328</td>
<td style="text-align: right;">0.391</td>
<td style="text-align: right;">0.110</td>
</tr>
<tr class="even">
<td style="text-align: left;">Unemployment only</td>
<td style="text-align: right;">0.108</td>
<td style="text-align: right;">0.144</td>
<td style="text-align: right;">0.024</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="plotting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="plotting-the-model">Plotting the Model</h3>
<p>I wanted to show a plot that might be easier to interpret, though that is always hard to do with z-scores. Its an unfortunate situation where the model calls for either z-scores, logistic scaling, or some other transformation so it wont have multicollinearity. I plotted citywide prediction curves for EZI and SLI with 95% confidence bands on the response scale. The EZI plot shows a clear trade‑off: as stress rises, the share of A‑grade restaurants declines steadily, while B and C both increase (B more than C). The SLI plot shows the mirror image because SLI was learned from A where moving “up” the SLI scale (less stress / stronger A signal) raises A and lowers grade B and grade C. EZI is a bit easier easy to explain, while SLI is optimized for prediction and matches the grade distribution much better.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df_idx<span class="sc">$</span>EZI_z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(df_idx<span class="sc">$</span>EZI_z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> <span class="dv">300</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">EZI_z =</span> x_seq)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Binomial predictions and CIs</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>pred_A <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>A_ezi, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>pred_B <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>B_ezi, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>pred_C <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>C_ezi, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plot_curves <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">EZI_z =</span> x_seq,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_hat =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_lwr =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_A<span class="sc">$</span>se.fit),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_upr =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_A<span class="sc">$</span>se.fit),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_hat =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_lwr =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_B<span class="sc">$</span>se.fit),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_upr =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_B<span class="sc">$</span>se.fit),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_hat =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_lwr =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_C<span class="sc">$</span>se.fit),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_upr =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_C<span class="sc">$</span>se.fit)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>EZI_z,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"grade"</span>,<span class="st">"stat"</span>),</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat, <span class="at">values_from =</span> value)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>plot_curves_faceted <span class="ot">&lt;-</span> plot_curves <span class="sc">|&gt;</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> <span class="fu">factor</span>(grade, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>),</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span>,<span class="st">"Grade B"</span>,<span class="st">"Grade C"</span>))</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>plot_curves_faceted<span class="sc">|&gt;</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(EZI_z, hat)) <span class="sc">+</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr, <span class="at">fill =</span> grade), <span class="at">alpha =</span> <span class="fl">0.20</span>) <span class="sc">+</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> grade), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grade, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span> <span class="ot">=</span> <span class="st">"#2C7FB8"</span>,</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Grade B"</span> <span class="ot">=</span> <span class="st">"#F28E2B"</span>,</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Grade C"</span> <span class="ot">=</span> <span class="st">"#E15759"</span>)) <span class="sc">+</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span> <span class="ot">=</span> <span class="st">"#2C7FB8"</span>,</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Grade B"</span> <span class="ot">=</span> <span class="st">"#F28E2B"</span>,</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Grade C"</span> <span class="ot">=</span> <span class="st">"#E15759"</span>)) <span class="sc">+</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Citywide predicted share by grade vs Economic Stress (EZI)"</span>,</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"One panel per grade; shaded bands are 95% CIs"</span>,</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"EZI (z-score across districts)"</span>,</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% of restaurants"</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="co"># SLI</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df_idx<span class="sc">$</span>SLI_z , <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(df_idx<span class="sc">$</span>SLI_z , <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> <span class="dv">300</span>)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SLI_z  =</span> x_seq)</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>pred_A <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>A_sli, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>pred_B <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>B_sli, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>pred_C <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>C_sli, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>plot_curves2 <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">SLI_z  =</span> x_seq,</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_hat =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit),</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_lwr =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_A<span class="sc">$</span>se.fit),</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_upr =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_A<span class="sc">$</span>se.fit),</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_hat =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit),</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_lwr =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_B<span class="sc">$</span>se.fit),</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_upr =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_B<span class="sc">$</span>se.fit),</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_hat =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit),</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_lwr =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_C<span class="sc">$</span>se.fit),</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_upr =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_C<span class="sc">$</span>se.fit)</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>SLI_z ,</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"grade"</span>,<span class="st">"stat"</span>),</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat, <span class="at">values_from =</span> value)</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>plot_curves_faceted2 <span class="ot">&lt;-</span> plot_curves2 <span class="sc">|&gt;</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> <span class="fu">factor</span>(grade, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>),</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span>,<span class="st">"Grade B"</span>,<span class="st">"Grade C"</span>))</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>plot_curves_faceted2<span class="sc">|&gt;</span></span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(SLI_z , hat)) <span class="sc">+</span></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr, <span class="at">fill =</span> grade), <span class="at">alpha =</span> <span class="fl">0.20</span>) <span class="sc">+</span></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> grade), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grade, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span> <span class="ot">=</span> <span class="st">"#2C7FB8"</span>,</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Grade B"</span> <span class="ot">=</span> <span class="st">"#F28E2B"</span>,</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Grade C"</span> <span class="ot">=</span> <span class="st">"#E15759"</span>)) <span class="sc">+</span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span> <span class="ot">=</span> <span class="st">"#2C7FB8"</span>,</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Grade B"</span> <span class="ot">=</span> <span class="st">"#F28E2B"</span>,</span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Grade C"</span> <span class="ot">=</span> <span class="st">"#E15759"</span>)) <span class="sc">+</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Citywide predicted share by grade vs Economic Stress (SLI)"</span>,</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Single curves per grade; shaded bands are 95% CIs"</span>,</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"SLI (z-score across districts)"</span>,</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% of restaurants"</span></span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="individual-report_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="individual-report_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Across grades, the index specifications (EZI and SLI) yield statistically meaningful effects, while the multiple model’s individual indicators are noisier and largely non‑significant. In the Grade A model, a 1‑SD increase in EZI (more economic stress) is associated with a decrease in the log‑odds of receiving Grade A (β = −0.148, <em>p</em> ≈ 0). Conversely, a 1‑SD increase in SLI (less stress/higher predicted A) is positive (β = 0.163, <em>p</em> ≈ 0). The multiple model’s rent burden, poverty, and unemployment terms are individually non‑significant for Grade A. For Grade B, the pattern mirrors Grade A: EZI is positive (β = 0.161, SE = 0.029, <em>z</em> = 5.59, <em>p</em> ≈ 0) and SLI is negative (β = −0.173, <em>p</em> ≈ 0), while separate rent, poverty, and unemployment terms do not reach significance. Finally, for Grade C, the signal is weaker but directionally consistent: EZI is positive (β = 0.095, <em>p</em> = 0.00149) and SLI is negative (β = −0.115, <em>p</em> = 0.00281). The multiple model’s three indicators again appear individually non‑significant.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hold</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>tidy_wald <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">terms =</span> <span class="cn">NULL</span>, <span class="at">robust =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">"HC1"</span>) {</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  est <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># robust vs classical variance-covariance</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  V   <span class="ot">&lt;-</span> <span class="cf">if</span> (robust) sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(mod, <span class="at">type =</span> type) <span class="cf">else</span> <span class="fu">vcov</span>(mod)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  se  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(V))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  z   <span class="ot">&lt;-</span> est <span class="sc">/</span> se</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  p   <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(z), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">term      =</span> <span class="fu">names</span>(est),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate  =</span> <span class="fu">as.numeric</span>(est),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">std.error =</span> <span class="fu">as.numeric</span>(se),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">as.numeric</span>(z),</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value   =</span> <span class="fu">as.numeric</span>(p)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(terms)) out <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(out, term <span class="sc">%in%</span> terms)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: safely pull one term; returns empty tibble if missing</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>tidy_wald_term <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, term, <span class="at">robust =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">"HC1"</span>) {</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">tidy_wald</span>(mod, <span class="at">robust =</span> robust, <span class="at">type =</span> type)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(res, .data<span class="sc">$</span>term <span class="sc">==</span> term)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co"># EZI_z for A/B/C</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>p_ezi <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>A_ezi, <span class="st">"EZI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade A"</span>, <span class="at">spec =</span> <span class="st">"EZI"</span>),</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>B_ezi, <span class="st">"EZI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade B"</span>, <span class="at">spec =</span> <span class="st">"EZI"</span>),</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>C_ezi, <span class="st">"EZI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade C"</span>, <span class="at">spec =</span> <span class="st">"EZI"</span>)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co"># SLI_z for A/B/C</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>p_sli <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>A_sli, <span class="st">"SLI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade A"</span>, <span class="at">spec =</span> <span class="st">"SLI"</span>),</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>B_sli, <span class="st">"SLI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade B"</span>, <span class="at">spec =</span> <span class="st">"SLI"</span>),</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>C_sli, <span class="st">"SLI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade C"</span>, <span class="at">spec =</span> <span class="st">"SLI"</span>)</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>p_multi <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald</span>(mods<span class="sc">$</span>A_multi, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"rent_z"</span>,<span class="st">"pov_z"</span>,<span class="st">"un_z"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade A"</span>, <span class="at">spec =</span> <span class="st">"Multiple"</span>),</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald</span>(mods<span class="sc">$</span>B_multi, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"rent_z"</span>,<span class="st">"pov_z"</span>,<span class="st">"un_z"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade B"</span>, <span class="at">spec =</span> <span class="st">"Multiple"</span>),</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald</span>(mods<span class="sc">$</span>C_multi, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"rent_z"</span>,<span class="st">"pov_z"</span>,<span class="st">"un_z"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade C"</span>, <span class="at">spec =</span> <span class="st">"Multiple"</span>))</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>p_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(p_ezi, p_sli, p_multi) <span class="sc">%&gt;%</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grade, spec, term, estimate, std.error, statistic, p.value) <span class="sc">%&gt;%</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate  =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>),</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">std.error =</span> <span class="fu">round</span>(std.error, <span class="dv">3</span>),</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">round</span>(statistic, <span class="dv">3</span>),</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value   =</span> <span class="fu">signif</span>(p.value, <span class="dv">3</span>)   <span class="co"># or round(p.value, 3)</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(grade, spec, term)</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>p_all <span class="sc">|&gt;</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">spec =</span> <span class="fu">recode</span>(spec,</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>      <span class="st">"EZI"</span>     <span class="ot">=</span> <span class="st">"EZI (equal-weight index)"</span>,</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>      <span class="st">"SLI"</span>     <span class="ot">=</span> <span class="st">"SLI (supervised index)"</span>,</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Multiple"</span><span class="ot">=</span> <span class="st">"Multiple (rent + poverty + unemployment)"</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">term =</span> <span class="fu">recode</span>(term,</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>      <span class="st">"EZI_z"</span> <span class="ot">=</span> <span class="st">"EZI (per 1 SD)"</span>,</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>      <span class="st">"SLI_z"</span> <span class="ot">=</span> <span class="st">"SLI (per 1 SD)"</span>,</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>      <span class="st">"rent_z"</span><span class="ot">=</span> <span class="st">"Rent burden (per 1 SD)"</span>,</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pov_z"</span> <span class="ot">=</span> <span class="st">"Poverty (per 1 SD)"</span>,</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>      <span class="st">"un_z"</span>  <span class="ot">=</span> <span class="st">"Unemployment (per 1 SD)"</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate  =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>),</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">std.error =</span> <span class="fu">round</span>(std.error, <span class="dv">3</span>),</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">round</span>(statistic, <span class="dv">3</span>),</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value   =</span> <span class="fu">signif</span>(p.value, <span class="dv">3</span>)</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(grade, spec, term)<span class="sc">|&gt;</span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(</span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Grade"</span>,<span class="st">"Model"</span>,<span class="st">"Term"</span>,<span class="st">"Estimate"</span>,</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"SE (robust)"</span>,<span class="st">"z"</span>,<span class="st">"p-value"</span>),</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"r"</span>,<span class="st">"r"</span>,<span class="st">"r"</span>,<span class="st">"r"</span>),</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Per-coefficient Wald tests (HC1 robust SEs)"</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"condensed"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">"top"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small">
<caption>Per-coefficient Wald tests (HC1 robust SEs)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Grade</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SE (robust)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" style="text-align: left; vertical-align: top !important;">Grade A</td>
<td style="text-align: left;">EZI (equal-weight index)</td>
<td style="text-align: left;">EZI (per 1 SD)</td>
<td style="text-align: right;">-0.148</td>
<td style="text-align: right;">0.029</td>
<td style="text-align: right;">-5.120</td>
<td style="text-align: right;">3.00e-07</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: left;">Poverty (per 1 SD)</td>
<td style="text-align: right;">-0.095</td>
<td style="text-align: right;">0.144</td>
<td style="text-align: right;">-0.657</td>
<td style="text-align: right;">5.11e-01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: left;">Rent burden (per 1 SD)</td>
<td style="text-align: right;">-0.132</td>
<td style="text-align: right;">0.088</td>
<td style="text-align: right;">-1.499</td>
<td style="text-align: right;">1.34e-01</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: left;">Unemployment (per 1 SD)</td>
<td style="text-align: right;">0.084</td>
<td style="text-align: right;">0.083</td>
<td style="text-align: right;">1.016</td>
<td style="text-align: right;">3.10e-01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SLI (supervised index)</td>
<td style="text-align: left;">SLI (per 1 SD)</td>
<td style="text-align: right;">0.163</td>
<td style="text-align: right;">0.030</td>
<td style="text-align: right;">5.362</td>
<td style="text-align: right;">1.00e-07</td>
</tr>
<tr class="even">
<td rowspan="5" style="text-align: left; vertical-align: top !important;">Grade B</td>
<td style="text-align: left;">EZI (equal-weight index)</td>
<td style="text-align: left;">EZI (per 1 SD)</td>
<td style="text-align: right;">0.161</td>
<td style="text-align: right;">0.029</td>
<td style="text-align: right;">5.593</td>
<td style="text-align: right;">0.00e+00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: left;">Poverty (per 1 SD)</td>
<td style="text-align: right;">0.132</td>
<td style="text-align: right;">0.115</td>
<td style="text-align: right;">1.152</td>
<td style="text-align: right;">2.49e-01</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: left;">Rent burden (per 1 SD)</td>
<td style="text-align: right;">0.109</td>
<td style="text-align: right;">0.071</td>
<td style="text-align: right;">1.551</td>
<td style="text-align: right;">1.21e-01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: left;">Unemployment (per 1 SD)</td>
<td style="text-align: right;">-0.084</td>
<td style="text-align: right;">0.068</td>
<td style="text-align: right;">-1.244</td>
<td style="text-align: right;">2.13e-01</td>
</tr>
<tr class="even">
<td style="text-align: left;">SLI (supervised index)</td>
<td style="text-align: left;">SLI (per 1 SD)</td>
<td style="text-align: right;">-0.173</td>
<td style="text-align: right;">0.028</td>
<td style="text-align: right;">-6.234</td>
<td style="text-align: right;">0.00e+00</td>
</tr>
<tr class="odd">
<td rowspan="5" style="text-align: left; vertical-align: top !important;">Grade C</td>
<td style="text-align: left;">EZI (equal-weight index)</td>
<td style="text-align: left;">EZI (per 1 SD)</td>
<td style="text-align: right;">0.095</td>
<td style="text-align: right;">0.030</td>
<td style="text-align: right;">3.178</td>
<td style="text-align: right;">1.49e-03</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: left;">Poverty (per 1 SD)</td>
<td style="text-align: right;">0.008</td>
<td style="text-align: right;">0.182</td>
<td style="text-align: right;">0.041</td>
<td style="text-align: right;">9.67e-01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: left;">Rent burden (per 1 SD)</td>
<td style="text-align: right;">0.149</td>
<td style="text-align: right;">0.113</td>
<td style="text-align: right;">1.316</td>
<td style="text-align: right;">1.88e-01</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiple (rent + poverty + unemployment)</td>
<td style="text-align: left;">Unemployment (per 1 SD)</td>
<td style="text-align: right;">-0.068</td>
<td style="text-align: right;">0.105</td>
<td style="text-align: right;">-0.645</td>
<td style="text-align: right;">5.19e-01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SLI (supervised index)</td>
<td style="text-align: left;">SLI (per 1 SD)</td>
<td style="text-align: right;">-0.115</td>
<td style="text-align: right;">0.039</td>
<td style="text-align: right;">-2.987</td>
<td style="text-align: right;">2.81e-03</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>While coefficients are reported on the log‑odds scale, I want to convey is that there is movement in the likelyhood of grades changing as neighborhood stress shifts. For example, with Grade A the EZI effect (β = −0.148) translates to an odds ratio of approximately 0.86, which is about a 14% reduction in the odds of an A for a one‑SD increase in stress. If a district is at roughly 60% A’s to begin with, a single standard deviation increase corresponds to a change of about −3 to −4 percentage points.</p>
<p>On the other hand, the SLI effect (β = 0.163) moves in the opposite direction and is of similar magnitude, raising the odds of A by ~18% and typically adding around +3 percentage points when the baseline is near the middle of the probability range. This basically means there is more movement in the middle, less at the extremes, which is pretty expected for logistic models, because probability changes are largest when the baseline is neither very low nor very high. The same logic applies over to Grade B and Grade C. For Grade B, EZI’s positive coefficient means B becomes more common as stress increases, while SLI’s negative coefficient means B recedes as SLI increases. Grade C shows much smaller in the same directions. The best way to understand this is like a see-saw: pushing up stress tilts the distribution away from A and toward B &amp; C, while raising SLI tilts it back toward A again. The tight confidence bands for A and B suggest a stable citywide relationship rather than noise in a handful of districts. While the model is significant for C, the variance and the confidence band is significantly large. Its likely that economic stress does not affect how common Cs are given out.</p>
</section>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>The aim for this subset study was to understand how lower economic indicators impact the type of inspection grade given out. Throughout this study, we have gone over multiple significant evidence from the EDA, index construction, and tests all pointing to an answer. That being districts with increasing economic stress tend to show fewer A grades and more B (with some C) grades. This is especially clear when an index is used because people that are unemployed are likely to be in poverty, and if their income is low (i.e.&nbsp;being in the poverty level), their rent burden is likely to be high as well.</p>
<p>There is a solution for this, and its really simple. Districts that have high economic stress should receive both economic and compliance support. Providing training, food safety materials, and small grants for repairs or upgrades to outdated equipment will go a long way in reducing the amount of restaurants not being able to comply with food safety standards. A two to four percentage point shift in grade A might sound like a small amount, but when we live in a city with tens of thousands of restaurants that can add up to a significant number. If the top quarterly of restaurants in the EZI were brought down by even half a standard deviation, there would be a large increase of A’s and thus a reductions in B’s. It would lead to fewer borderline cases, likely less incidents with food poisoning, and overall help communities’ economic and physical health.</p>
</section>
<section id="potential-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="potential-next-steps">Potential Next steps</h2>
<p>This study was done with 2 index models and 3 indicator variables. Additional covariates like the highest level of education achieved, Gentrification, or Homes reporting cockroaches could be implemented into these models. Additionally, testing other models like an unsupervised indices (PCA scores) against SLI and EZI could be done to see what model fits best. There could be other questions that stem from this such as how do index effects differ across boroughs, or even districts? Exploring further would help build a solid case to build a policy on supporting restaurants in lower economic areas.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/tylerml71\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Final Individual Report: Kitchen safety and the Economy"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">    mode: source</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">    html:</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">      toc: true</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">      toc-depth: 3</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">      toc-location: left</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">      sections: true</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">      toc-floating: true</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">      code-fold: true</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">      code-summary: "Show the code"</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">      code-tools:</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">          toggle: true</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">          source: true</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">          caption: "code"</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>This project was completed by four members including myself. We aimed to answer how restaurant quality relates to community health across NYC neighborhoods. In order to explore every aspect of this question, it was split into four parts for each member. I was tasked with asking the question: ***How do lower economic indicators correlate with inspection grades given to restaurants?*** To answer this question, I pulled some data and went through an in-depth analysis on how impactful some economic indicators can be on Food and Health safety.</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup and Cleaning</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>I will be using 2 of the 3 mentioned datasets in the project, NYC community health profiles and inspection results. There is no reason to include 311 sickness reports, as we are looking at the relation between economic indicators and grades in restaurants. Though, that is another question that could be looked at in the future.</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup}</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl); <span class="fu">library</span>(tibble); <span class="fu">library</span>(dplyr)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(ggplot2); <span class="fu">library</span>(reshape2)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate); <span class="fu">library</span>(scales); <span class="fu">library</span>(janitor)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats); <span class="fu">library</span>(patchwork); <span class="fu">library</span>(scales)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT); <span class="fu">library</span>(glue); <span class="fu">library</span>(httr2); <span class="fu">library</span>(cowplot);</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr); <span class="fu">library</span>(diptest); <span class="fu">library</span>(kableExtra)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally);<span class="fu">library</span>(arm);<span class="fu">library</span>(broom);<span class="fu">library</span>(car)</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conflicted);<span class="fu">library</span>(glmnet);<span class="fu">library</span>(lmtest); <span class="fu">library</span>(sandwich)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"select"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>recode)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>inspection_df <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">dest_dir      =</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"finproj"</span>),</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename      =</span> <span class="st">"dohmh_restaurant_inspections.csv"</span>,</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">force_refresh =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">guess_max     =</span> <span class="dv">100000</span>,</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">quiet_readr   =</span> <span class="cn">TRUE</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>  src_url   <span class="ot">&lt;-</span> <span class="st">"https://data.cityofnewyork.us/api/views/43nn-pn8j/rows.csv?accessType=DOWNLOAD"</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>  dest_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, filename)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dest_dir)) <span class="fu">dir.create</span>(dest_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>  needs_download <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">file.exists</span>(dest_file) <span class="sc">||</span> <span class="fu">isTRUE</span>(force_refresh)</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (needs_download) {</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">ifelse</span>(force_refresh, <span class="st">"Refreshing file: "</span>, <span class="st">"Downloading: "</span>), src_url)</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> httr2<span class="sc">::</span><span class="fu">req_perform</span>(httr2<span class="sc">::</span><span class="fu">request</span>(src_url))</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>    httr2<span class="sc">::</span><span class="fu">resp_check_status</span>(resp)</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>    raw <span class="ot">&lt;-</span> httr2<span class="sc">::</span><span class="fu">resp_body_raw</span>(resp)</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".csv"</span>)</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">write_file</span>(raw, tmp)</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.rename</span>(tmp, dest_file)</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"File saved to: "</span>, dest_file)</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"File already exists in destination: "</span>, dest_file)</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(dest_file,</span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>                        <span class="at">guess_max =</span> guess_max,</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>                        <span class="at">show_col_types =</span> <span class="sc">!</span>quiet_readr)</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"INSPECTION DATE"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>    df[[<span class="st">"INSPECTION DATE"</span>]] <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lubridate<span class="sc">::</span><span class="fu">mdy</span>(df[[<span class="st">"INSPECTION DATE"</span>]]))</span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"RECORD DATE"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>    df[[<span class="st">"RECORD DATE"</span>]] <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lubridate<span class="sc">::</span><span class="fu">mdy</span>(df[[<span class="st">"RECORD DATE"</span>]]))</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a>inspection<span class="ot">&lt;-</span> <span class="fu">inspection_df</span>()</span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a>community_health_df <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Source url and file names</span></span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>  src_url  <span class="ot">&lt;-</span> <span class="st">"https://www.nyc.gov/assets/doh/downloads/excel/episrv/2022-chp-pud.xlsx"</span></span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a>  src_name <span class="ot">&lt;-</span> <span class="fu">basename</span>(src_url)  </span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Destination paths</span></span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a>  dest_dir  <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"finproj"</span>)</span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>  dest_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dest_dir, src_name)</span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(dest_dir)) {</span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dest_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(dest_file)) {</span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Downloading: "</span>, src_url)</span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>    utils<span class="sc">::</span><span class="fu">download.file</span>(src_url, dest_file, <span class="at">mode =</span> <span class="st">"wb"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"File saved to: "</span>, dest_file)</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"File already exists in destination: "</span>, dest_file)</span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(dest_file, <span class="at">sheet =</span> <span class="st">"CHP_all_data"</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">66</span><span class="sc">:</span><span class="dv">69</span>), ]</span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>community_health<span class="ot">&lt;-</span><span class="fu">community_health_df</span>()</span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a>format_titles <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(<span class="fu">colnames</span>(df), <span class="st">"_"</span>, <span class="st">" "</span>) <span class="sc">|&gt;</span> <span class="fu">str_to_title</span>()</span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a>is_borough_level <span class="ot">&lt;-</span> community_health<span class="sc">$</span>ID <span class="sc">%in%</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a><span class="co">#Bourough rows</span></span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a>ch_boroughs <span class="ot">&lt;-</span> <span class="fu">subset</span>(community_health, is_borough_level)<span class="sc">|&gt;</span></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(ID<span class="sc">==</span><span class="st">"0"</span>))</span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a><span class="co">#Community District rows</span></span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a>ch_neighbor <span class="ot">&lt;-</span> <span class="fu">subset</span>(community_health, <span class="sc">!</span>is_borough_level)</span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a>Now that we have setup the code, lets look at the economic indicators we will be using. The measure Rent Burden is classified as the percentage of renter-occupied homes whose gross rent is equal or greater than 30 percent of household income in the past 12 months. The measure unemployment is the Percentage of civilian labor force that are 16 and older, and unemployed. Finally, poverty is the percentage of residents living below 100% of New York City’s calculated poverty threshold based on income and necessary expenses. All of these are important indicators for how well people are doing financially each area. The idea is that if rent is expensive, unemployment is high, and/or poverty is high, people are less likely to buy food from restaurants. This in turn would lead restaurants to have less income to spend on food compliance and thus lower their grade on the next inspection. Below is a sample of the data we will be working with.</span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a>ch_neighbor<span class="sc">|&gt;</span> </span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a>    Name,</span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a>    Poverty,</span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a>    Rent_Burden,</span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a>    Unemployment</span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(Poverty, Rent_Burden, Unemployment),</span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">label_percent</span>(<span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="dv">1</span>)(.x)</span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_titles</span>()<span class="sc">|&gt;</span></span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">20</span>)<span class="sc">|&gt;</span></span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a>            <span class="at">options=</span> <span class="fu">list</span>(</span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a>              <span class="at">pagelength=</span><span class="dv">5</span>, </span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a>              <span class="at">lengthMenu =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)</span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a>When looking at inspection data, I found that there were restaurants that were repeated multiple times, and on the same day. Not only this, but grades with Na's and other letters (like N for "Not Yet Graded") were present. This is because each individual violation is recorded and noted if it is critically important or not. While this would be helpful for answering other questions in this project like the amount of critical flags in a district, it isn't here. Having repeats of the same grade and non-grading letters can drastically warp our findings.</span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a>inspection<span class="sc">|&gt;</span></span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()<span class="sc">|&gt;</span></span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_dupes</span>(camis, inspection_date)<span class="sc">|&gt;</span></span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(grade))<span class="sc">|&gt;</span></span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">30</span>)<span class="sc">|&gt;</span></span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">name=</span>dba, critical_flag, inspection_date, grade)<span class="sc">|&gt;</span></span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_titles</span>()<span class="sc">|&gt;</span></span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(<span class="at">rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true" tabindex="-1"></a>            <span class="at">options=</span> <span class="fu">list</span>(</span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true" tabindex="-1"></a>              <span class="at">pagelength=</span><span class="dv">5</span>, </span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true" tabindex="-1"></a>              <span class="at">lengthMenu =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)</span>
<span id="cb15-200"><a href="#cb15-200" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb15-201"><a href="#cb15-201" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-203"><a href="#cb15-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-204"><a href="#cb15-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-205"><a href="#cb15-205" aria-hidden="true" tabindex="-1"></a>To make sure this dataset can join with community health, we added district/neighborhood groups based on the zip code. Mutating to an ID and joining it is definitely the optimal and safe option, but the amount of rows in the community health dataset is relatively small. This means we can copy the exact name of the area from the dataset and put it in this code. Now that the data is cleaned, we can move on to the next step.</span>
<span id="cb15-206"><a href="#cb15-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-207"><a href="#cb15-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r }</span></span>
<span id="cb15-208"><a href="#cb15-208" aria-hidden="true" tabindex="-1"></a>inspection_cleaned <span class="ot">&lt;-</span> inspection <span class="sc">|&gt;</span></span>
<span id="cb15-209"><a href="#cb15-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()<span class="sc">|&gt;</span></span>
<span id="cb15-210"><a href="#cb15-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-211"><a href="#cb15-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">neighborhood_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-212"><a href="#cb15-212" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10031</span>, <span class="dv">10032</span>, <span class="dv">10033</span>, <span class="dv">10034</span>, <span class="dv">10040</span>) <span class="sc">~</span> <span class="st">"Washington Heights and Inwood"</span>,</span>
<span id="cb15-213"><a href="#cb15-213" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10026</span>, <span class="dv">10030</span>, <span class="dv">10037</span>, <span class="dv">10039</span>) <span class="sc">~</span> <span class="st">"Central Harlem"</span>,</span>
<span id="cb15-214"><a href="#cb15-214" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10029</span>, <span class="dv">10035</span>) <span class="sc">~</span> <span class="st">"East Harlem"</span>,</span>
<span id="cb15-215"><a href="#cb15-215" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10023</span>, <span class="dv">10024</span>) <span class="sc">~</span> <span class="st">"Upper West Side"</span>,</span>
<span id="cb15-216"><a href="#cb15-216" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10021</span>, <span class="dv">10028</span>, <span class="dv">10044</span>, <span class="dv">10065</span>, <span class="dv">10075</span>, <span class="dv">10128</span>) <span class="sc">~</span> <span class="st">"Upper East Side"</span>,</span>
<span id="cb15-217"><a href="#cb15-217" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10001</span>, <span class="dv">10011</span>, <span class="dv">10018</span>, <span class="dv">10019</span>, <span class="dv">10020</span>, <span class="dv">10036</span>) <span class="sc">~</span> <span class="st">"Clinton and Chelsea"</span>,</span>
<span id="cb15-218"><a href="#cb15-218" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10010</span>, <span class="dv">10016</span>, <span class="dv">10017</span>, <span class="dv">10022</span>) <span class="sc">~</span> <span class="st">"Stuyvesant Town and Turtle Bay"</span>,</span>
<span id="cb15-219"><a href="#cb15-219" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10012</span>, <span class="dv">10013</span>, <span class="dv">10014</span>) <span class="sc">~</span> <span class="st">"Greenwich Village and Soho"</span>,</span>
<span id="cb15-220"><a href="#cb15-220" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10002</span>, <span class="dv">10003</span>, <span class="dv">10009</span>) <span class="sc">~</span> <span class="st">"Lower East Side and Chinatown"</span>,</span>
<span id="cb15-221"><a href="#cb15-221" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10004</span>, <span class="dv">10005</span>, <span class="dv">10006</span>, <span class="dv">10007</span>, <span class="dv">10038</span>, <span class="dv">10280</span>) <span class="sc">~</span> <span class="st">"Financial District"</span>,</span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10025</span>, <span class="dv">10027</span>) <span class="sc">~</span> <span class="st">"Morningside Heights and Hamilton Heights"</span>,</span>
<span id="cb15-223"><a href="#cb15-223" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-224"><a href="#cb15-224" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10301</span>, <span class="dv">10302</span>, <span class="dv">10303</span>, <span class="dv">10304</span>, <span class="dv">10305</span>, <span class="dv">10310</span>) <span class="sc">~</span> <span class="st">"St. George and Stapleton"</span>,</span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10306</span>, <span class="dv">10314</span>) <span class="sc">~</span> <span class="st">"South Beach and Willowbrook"</span>,</span>
<span id="cb15-226"><a href="#cb15-226" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10307</span>, <span class="dv">10308</span>, <span class="dv">10309</span>, <span class="dv">10312</span>) <span class="sc">~</span> <span class="st">"Tottenville and Great Kills"</span>,</span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10451</span>, <span class="dv">10454</span>, <span class="dv">10455</span>, <span class="dv">10456</span>, <span class="dv">10459</span>) <span class="sc">~</span> <span class="st">"Mott Haven and Melrose"</span>,</span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10474</span>, <span class="dv">10475</span>) <span class="sc">~</span> <span class="st">"Hunts Point and Longwood"</span>,</span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10453</span>, <span class="dv">10457</span>, <span class="dv">10458</span>, <span class="dv">10460</span>) <span class="sc">~</span> <span class="st">"Morrisania and Crotona"</span>,</span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10452</span>, <span class="dv">10456</span>, <span class="dv">10451</span>) <span class="sc">~</span> <span class="st">"Highbridge and Concourse"</span>,</span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10453</span>, <span class="dv">10458</span>, <span class="dv">10467</span>, <span class="dv">10468</span>) <span class="sc">~</span> <span class="st">"Fordham and University Heights"</span>,</span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10457</span>, <span class="dv">10458</span>, <span class="dv">10461</span>) <span class="sc">~</span> <span class="st">"Belmont and East Tremont"</span>,</span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10463</span>, <span class="dv">10471</span>) <span class="sc">~</span> <span class="st">"Kingsbridge Heights and Bedford"</span>,</span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10463</span>, <span class="dv">10471</span>) <span class="sc">~</span> <span class="st">"Riverdale and Fieldston"</span>,</span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10462</span>, <span class="dv">10473</span>) <span class="sc">~</span> <span class="st">"Parkchester and Soundview"</span>,</span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10461</span>, <span class="dv">10465</span>, <span class="dv">10472</span>, <span class="dv">10473</span>) <span class="sc">~</span> <span class="st">"Throgs Neck and Co-op City"</span>,</span>
<span id="cb15-238"><a href="#cb15-238" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10461</span>, <span class="dv">10462</span>) <span class="sc">~</span> <span class="st">"Morris Park and Bronxdale"</span>,</span>
<span id="cb15-239"><a href="#cb15-239" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10466</span>, <span class="dv">10467</span>, <span class="dv">10469</span>) <span class="sc">~</span> <span class="st">"Williamsbridge and Baychester"</span>,</span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11211</span>, <span class="dv">11222</span>) <span class="sc">~</span> <span class="st">"Greenpoint and Williamsburg"</span>,</span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11201</span>, <span class="dv">11205</span>) <span class="sc">~</span> <span class="st">"Fort Greene and Brooklyn Heights"</span>,</span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11206</span>, <span class="dv">11216</span>, <span class="dv">11221</span>, <span class="dv">11233</span>, <span class="dv">11238</span>) <span class="sc">~</span> <span class="st">"Bedford Stuyvesant"</span>,</span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11207</span>, <span class="dv">11221</span>, <span class="dv">11237</span>) <span class="sc">~</span> <span class="st">"Bushwick"</span>,</span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11207</span>, <span class="dv">11208</span>) <span class="sc">~</span> <span class="st">"East New York and Starrett City"</span>,</span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11215</span>, <span class="dv">11217</span>, <span class="dv">11231</span>) <span class="sc">~</span> <span class="st">"Park Slope and Carroll Gardens"</span>,</span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11220</span>, <span class="dv">11232</span>) <span class="sc">~</span> <span class="st">"Sunset Park"</span>,</span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11213</span>, <span class="dv">11216</span>, <span class="dv">11225</span>, <span class="dv">11238</span>) <span class="sc">~</span> <span class="st">"Crown Heights and Prospect Heights"</span>,</span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11203</span>, <span class="dv">11212</span>) <span class="sc">~</span> <span class="st">"South Crown Heights and Lefferts Gardens"</span>,</span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11209</span>, <span class="dv">11220</span>) <span class="sc">~</span> <span class="st">"Bay Ridge and Dyker Heights"</span>,</span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11204</span>, <span class="dv">11214</span>, <span class="dv">11228</span>) <span class="sc">~</span> <span class="st">"Bensonhurst"</span>,</span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11204</span>, <span class="dv">11218</span>, <span class="dv">11219</span>, <span class="dv">11230</span>) <span class="sc">~</span> <span class="st">"borough Park"</span>,</span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11224</span>) <span class="sc">~</span> <span class="st">"Coney Island"</span>,</span>
<span id="cb15-254"><a href="#cb15-254" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11203</span>, <span class="dv">11210</span>, <span class="dv">11226</span>) <span class="sc">~</span> <span class="st">"Flatbush and Midwood"</span>,</span>
<span id="cb15-255"><a href="#cb15-255" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11235</span>) <span class="sc">~</span> <span class="st">"Sheepshead Bay"</span>,</span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11212</span>, <span class="dv">11233</span>) <span class="sc">~</span> <span class="st">"Brownsville"</span>,</span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11203</span>, <span class="dv">11226</span>, <span class="dv">11230</span>) <span class="sc">~</span> <span class="st">"East Flatbush"</span>,</span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11236</span>, <span class="dv">11234</span>) <span class="sc">~</span> <span class="st">"Flatlands and Canarsie"</span>,</span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-260"><a href="#cb15-260" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11101</span>, <span class="dv">11102</span>, <span class="dv">11103</span>, <span class="dv">11104</span>, <span class="dv">11105</span>, <span class="dv">11106</span>, <span class="dv">11369</span>, <span class="dv">11370</span>, <span class="dv">11377</span>) <span class="sc">~</span> <span class="st">"Long Island City and Astoria"</span>,</span>
<span id="cb15-261"><a href="#cb15-261" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11377</span>, <span class="dv">11378</span>, <span class="dv">11379</span>) <span class="sc">~</span> <span class="st">"Woodside and Sunnyside"</span>,</span>
<span id="cb15-262"><a href="#cb15-262" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11372</span>, <span class="dv">11373</span>, <span class="dv">11374</span>) <span class="sc">~</span> <span class="st">"Jackson Heights"</span>,</span>
<span id="cb15-263"><a href="#cb15-263" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11373</span>, <span class="dv">11375</span>, <span class="dv">11368</span>) <span class="sc">~</span> <span class="st">"Elmhurst and Corona"</span>,</span>
<span id="cb15-264"><a href="#cb15-264" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11385</span>, <span class="dv">11378</span>) <span class="sc">~</span> <span class="st">"Ridgewood and Maspeth"</span>,</span>
<span id="cb15-265"><a href="#cb15-265" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11374</span>, <span class="dv">11375</span>, <span class="dv">11385</span>) <span class="sc">~</span> <span class="st">"Rego Park and Forest Hills"</span>,</span>
<span id="cb15-266"><a href="#cb15-266" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11354</span>, <span class="dv">11355</span>, <span class="dv">11356</span>, <span class="dv">11357</span>, <span class="dv">11358</span>) <span class="sc">~</span> <span class="st">"Flushing and Whitestone"</span>,</span>
<span id="cb15-267"><a href="#cb15-267" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11365</span>, <span class="dv">11366</span>, <span class="dv">11367</span>) <span class="sc">~</span> <span class="st">"Hillcrest and Fresh Meadows"</span>,</span>
<span id="cb15-268"><a href="#cb15-268" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11415</span>, <span class="dv">11416</span>, <span class="dv">11421</span>) <span class="sc">~</span> <span class="st">"Kew Gardens and Woodhaven"</span>,</span>
<span id="cb15-269"><a href="#cb15-269" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11417</span>, <span class="dv">11419</span>, <span class="dv">11420</span>) <span class="sc">~</span> <span class="st">"South Ozone Park and Howard Beach"</span>,</span>
<span id="cb15-270"><a href="#cb15-270" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11360</span>, <span class="dv">11361</span>, <span class="dv">11362</span>) <span class="sc">~</span> <span class="st">"Bayside and Little Neck"</span>,</span>
<span id="cb15-271"><a href="#cb15-271" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11412</span>, <span class="dv">11423</span>, <span class="dv">11432</span>, <span class="dv">11433</span>, <span class="dv">11434</span>) <span class="sc">~</span> <span class="st">"Jamaica and Hollis"</span>,</span>
<span id="cb15-272"><a href="#cb15-272" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11427</span>, <span class="dv">11428</span>, <span class="dv">11429</span>) <span class="sc">~</span> <span class="st">"Queens Village"</span>,</span>
<span id="cb15-273"><a href="#cb15-273" aria-hidden="true" tabindex="-1"></a>      zipcode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11691</span>, <span class="dv">11692</span>, <span class="dv">11693</span>, <span class="dv">11694</span>, <span class="dv">11695</span>) <span class="sc">~</span> <span class="st">"Rockaway and Broad Channel"</span>,</span>
<span id="cb15-274"><a href="#cb15-274" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb15-275"><a href="#cb15-275" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-276"><a href="#cb15-276" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb15-277"><a href="#cb15-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="fu">pick</span>(camis, inspection_date), <span class="at">.keep_all=</span><span class="cn">TRUE</span>)<span class="sc">|&gt;</span></span>
<span id="cb15-278"><a href="#cb15-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>), <span class="fu">year</span>(inspection_date)<span class="sc">&gt;=</span> <span class="dv">2021</span> </span>
<span id="cb15-279"><a href="#cb15-279" aria-hidden="true" tabindex="-1"></a>         <span class="sc">&amp;</span> <span class="fu">year</span>(inspection_date)<span class="sc">&lt;=</span> <span class="dv">2025</span> )<span class="sc">|&gt;</span></span>
<span id="cb15-280"><a href="#cb15-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inspection_date=</span> <span class="fu">as.Date</span>(inspection_date, <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb15-281"><a href="#cb15-281" aria-hidden="true" tabindex="-1"></a>         <span class="at">grade_date=</span> <span class="fu">as.Date</span>(inspection_date, <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>)</span>
<span id="cb15-282"><a href="#cb15-282" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb15-283"><a href="#cb15-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-284"><a href="#cb15-284" aria-hidden="true" tabindex="-1"></a>ch_neighbor<span class="ot">&lt;-</span> ch_neighbor<span class="sc">|&gt;</span></span>
<span id="cb15-285"><a href="#cb15-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), <span class="sc">~</span> <span class="fu">na_if</span>(., <span class="st">"n/a"</span>)))<span class="sc">|&gt;</span></span>
<span id="cb15-286"><a href="#cb15-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb15-287"><a href="#cb15-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-288"><a href="#cb15-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-289"><a href="#cb15-289" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> inspection_cleaned<span class="sc">|&gt;</span></span>
<span id="cb15-290"><a href="#cb15-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ch_neighbor, </span>
<span id="cb15-291"><a href="#cb15-291" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"neighborhood_group"</span> <span class="ot">=</span> <span class="st">"name"</span>))<span class="sc">|&gt;</span></span>
<span id="cb15-292"><a href="#cb15-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">name=</span>neighborhood_group)<span class="sc">|&gt;</span></span>
<span id="cb15-293"><a href="#cb15-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb15-294"><a href="#cb15-294" aria-hidden="true" tabindex="-1"></a>    name, id,</span>
<span id="cb15-295"><a href="#cb15-295" aria-hidden="true" tabindex="-1"></a>    poverty, unemployment, rent_burden,</span>
<span id="cb15-296"><a href="#cb15-296" aria-hidden="true" tabindex="-1"></a>    grade, score, grade_date,</span>
<span id="cb15-297"><a href="#cb15-297" aria-hidden="true" tabindex="-1"></a>    inspection_date,borough)</span>
<span id="cb15-298"><a href="#cb15-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-299"><a href="#cb15-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-300"><a href="#cb15-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-301"><a href="#cb15-301" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb15-302"><a href="#cb15-302" aria-hidden="true" tabindex="-1"></a>I also separated IDs 0-5 from community_health, those IDs specifically show borough and city wide data. It might be used later, so it is split into a separate dataset for now.</span>
<span id="cb15-303"><a href="#cb15-303" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb15-304"><a href="#cb15-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-305"><a href="#cb15-305" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exploratory Data Analysis (EDA)</span></span>
<span id="cb15-306"><a href="#cb15-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-307"><a href="#cb15-307" aria-hidden="true" tabindex="-1"></a>I began with some exploratory data analysis to understand the socioeconomic indicators at the district level. I gave histograms a mean reference line to assess the central tendency, spread, and skewedness of the data. There is some moderate variation in poverty and rent burden, and a right skewedness in unemployment. Unemployment also is the only one that has an outlier in the box plot, being around 13%.</span>
<span id="cb15-308"><a href="#cb15-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-311"><a href="#cb15-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-312"><a href="#cb15-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb15-313"><a href="#cb15-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb15-314"><a href="#cb15-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb15-315"><a href="#cb15-315" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-show: hold</span></span>
<span id="cb15-316"><a href="#cb15-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-317"><a href="#cb15-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-318"><a href="#cb15-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-319"><a href="#cb15-319" aria-hidden="true" tabindex="-1"></a>ch_plot <span class="ot">&lt;-</span> ch_neighbor <span class="sc">|&gt;</span></span>
<span id="cb15-320"><a href="#cb15-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), <span class="sc">~</span> <span class="fu">na_if</span>(.x, <span class="st">"n/a"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb15-321"><a href="#cb15-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(poverty,</span>
<span id="cb15-322"><a href="#cb15-322" aria-hidden="true" tabindex="-1"></a>         rent_burden,</span>
<span id="cb15-323"><a href="#cb15-323" aria-hidden="true" tabindex="-1"></a>         unemployment) <span class="sc">|&gt;</span></span>
<span id="cb15-324"><a href="#cb15-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format_titles</span>()</span>
<span id="cb15-325"><a href="#cb15-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-326"><a href="#cb15-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-327"><a href="#cb15-327" aria-hidden="true" tabindex="-1"></a>indicators <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Poverty"</span>,<span class="st">"Rent Burden"</span>,<span class="st">"Unemployment"</span> )</span>
<span id="cb15-328"><a href="#cb15-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-329"><a href="#cb15-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-330"><a href="#cb15-330" aria-hidden="true" tabindex="-1"></a>plot_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(indicators, <span class="cf">function</span>(v) {</span>
<span id="cb15-331"><a href="#cb15-331" aria-hidden="true" tabindex="-1"></a>  bw <span class="ot">&lt;-</span> <span class="cf">if</span> (v <span class="sc">==</span> <span class="st">"Unemployment"</span>) <span class="dv">1</span> <span class="cf">else</span> <span class="dv">2</span></span>
<span id="cb15-332"><a href="#cb15-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(ch_plot, <span class="fu">aes</span>(<span class="at">x =</span> .data[[v]])) <span class="sc">+</span></span>
<span id="cb15-333"><a href="#cb15-333" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> bw, <span class="at">fill =</span> <span class="st">"#4E79A7"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb15-334"><a href="#cb15-334" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(</span>
<span id="cb15-335"><a href="#cb15-335" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(.data[[v]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb15-336"><a href="#cb15-336" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span></span>
<span id="cb15-337"><a href="#cb15-337" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb15-338"><a href="#cb15-338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> v, <span class="at">x =</span> <span class="st">"%"</span>, <span class="at">y =</span> <span class="st">"Districts"</span>) <span class="sc">+</span></span>
<span id="cb15-339"><a href="#cb15-339" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb15-340"><a href="#cb15-340" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb15-341"><a href="#cb15-341" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-342"><a href="#cb15-342" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-343"><a href="#cb15-343" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb15-344"><a href="#cb15-344" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-345"><a href="#cb15-345" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-346"><a href="#cb15-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-347"><a href="#cb15-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-348"><a href="#cb15-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-349"><a href="#cb15-349" aria-hidden="true" tabindex="-1"></a>plot_list2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(indicators, <span class="cf">function</span>(v) {</span>
<span id="cb15-350"><a href="#cb15-350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(ch_plot, <span class="fu">aes</span>(<span class="at">x =</span> .data[[v]])) <span class="sc">+</span></span>
<span id="cb15-351"><a href="#cb15-351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"#4E79A7"</span>) <span class="sc">+</span></span>
<span id="cb15-352"><a href="#cb15-352" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> v, <span class="at">x =</span> <span class="st">"%"</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb15-353"><a href="#cb15-353" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb15-354"><a href="#cb15-354" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb15-355"><a href="#cb15-355" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-356"><a href="#cb15-356" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-357"><a href="#cb15-357" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-358"><a href="#cb15-358" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-359"><a href="#cb15-359" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb15-360"><a href="#cb15-360" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb15-361"><a href="#cb15-361" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-362"><a href="#cb15-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-363"><a href="#cb15-363" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(plot_list, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb15-364"><a href="#cb15-364" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(plot_list2, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb15-365"><a href="#cb15-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-366"><a href="#cb15-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-367"><a href="#cb15-367" aria-hidden="true" tabindex="-1"></a>Rent burden and unemployment did not look unimodal, so to see if they are unimodal I conducted the Hartigan's Dip test. It indicated poverty and rent burden are consistent with unimodal distributions. However, Unemployment's test is significant, meaning it indicates significant bimodality. This is likely because of the few districts with a high unemployment rate. I also wanted to use density plots to check if these indicators have similar shapes or different patterns, which can help with deciding a good fitting model. Again, Unemployment seems to re-occur with skewedness and a decently heavy tail, causing this unimodality.</span>
<span id="cb15-368"><a href="#cb15-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-371"><a href="#cb15-371" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-372"><a href="#cb15-372" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hold</span></span>
<span id="cb15-373"><a href="#cb15-373" aria-hidden="true" tabindex="-1"></a>long <span class="ot">&lt;-</span> ch_plot <span class="sc">|&gt;</span></span>
<span id="cb15-374"><a href="#cb15-374" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Poverty, <span class="st">`</span><span class="at">Rent Burden</span><span class="st">`</span>, Unemployment),</span>
<span id="cb15-375"><a href="#cb15-375" aria-hidden="true" tabindex="-1"></a>                      <span class="at">names_to =</span> <span class="st">"indicator"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb15-376"><a href="#cb15-376" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> long <span class="sc">|&gt;</span></span>
<span id="cb15-377"><a href="#cb15-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(indicator) <span class="sc">|&gt;</span></span>
<span id="cb15-378"><a href="#cb15-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb15-379"><a href="#cb15-379" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> <span class="fu">dip.test</span>(value[<span class="sc">!</span><span class="fu">is.na</span>(value)])<span class="sc">$</span>p.value,</span>
<span id="cb15-380"><a href="#cb15-380" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb15-381"><a href="#cb15-381" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-382"><a href="#cb15-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(p_value)</span>
<span id="cb15-383"><a href="#cb15-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-384"><a href="#cb15-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-385"><a href="#cb15-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-386"><a href="#cb15-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-387"><a href="#cb15-387" aria-hidden="true" tabindex="-1"></a>long<span class="sc">|&gt;</span></span>
<span id="cb15-388"><a href="#cb15-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(value, <span class="at">fill =</span> indicator)) <span class="sc">+</span></span>
<span id="cb15-389"><a href="#cb15-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">adjust =</span> <span class="fl">1.0</span>) <span class="sc">+</span></span>
<span id="cb15-390"><a href="#cb15-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> indicator, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb15-391"><a href="#cb15-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"%"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)<span class="sc">+</span></span>
<span id="cb15-392"><a href="#cb15-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb15-393"><a href="#cb15-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-394"><a href="#cb15-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-395"><a href="#cb15-395" aria-hidden="true" tabindex="-1"></a>res<span class="sc">|&gt;</span></span>
<span id="cb15-396"><a href="#cb15-396" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb15-397"><a href="#cb15-397" aria-hidden="true" tabindex="-1"></a>    <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb15-398"><a href="#cb15-398" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">5</span>,</span>
<span id="cb15-399"><a href="#cb15-399" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Indicator"</span>, <span class="st">"Dip test p-value"</span>),</span>
<span id="cb15-400"><a href="#cb15-400" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"c"</span>),</span>
<span id="cb15-401"><a href="#cb15-401" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.attr =</span> <span class="st">"style='width:420px; margin-left:auto; margin-right:auto;'"</span></span>
<span id="cb15-402"><a href="#cb15-402" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-403"><a href="#cb15-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">position =</span> <span class="st">"center"</span>,</span>
<span id="cb15-404"><a href="#cb15-404" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"condensed"</span>))</span>
<span id="cb15-405"><a href="#cb15-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-406"><a href="#cb15-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-407"><a href="#cb15-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-410"><a href="#cb15-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{html}</span></span>
<span id="cb15-411"><a href="#cb15-411" aria-hidden="true" tabindex="-1"></a>table<span class="op">.</span>table <span class="op">{</span>   width<span class="op">:</span> <span class="kw">auto</span> <span class="op">!</span>important<span class="op">;</span>   margin<span class="op">-</span>left<span class="op">:</span> <span class="kw">auto</span><span class="op">;</span>   margin<span class="op">-</span>right<span class="op">:</span> <span class="kw">auto</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb15-412"><a href="#cb15-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-413"><a href="#cb15-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-414"><a href="#cb15-414" aria-hidden="true" tabindex="-1"></a>Finally, I wanted to test if there was a correlation between these three variables. This is important because if the predictors have low/moderate correlation, a model with these variables could be more accurate. But if they are too high, these correlations could make the coefficients unstable and the model unreliable. Looking at the pair plots, rent burden and unemployment have the lowest correlation, but still moderately high at 0.62. All three pairs have upward trends, and the cloud of points are fairly linear with some spread.</span>
<span id="cb15-415"><a href="#cb15-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-418"><a href="#cb15-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-419"><a href="#cb15-419" aria-hidden="true" tabindex="-1"></a>GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb15-420"><a href="#cb15-420" aria-hidden="true" tabindex="-1"></a>  ch_plot,</span>
<span id="cb15-421"><a href="#cb15-421" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Poverty"</span>,<span class="st">"Rent Burden"</span>,<span class="st">"Unemployment"</span>),</span>
<span id="cb15-422"><a href="#cb15-422" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> GGally<span class="sc">::</span><span class="fu">wrap</span>(<span class="st">"cor"</span>, <span class="at">size =</span> <span class="dv">4</span>)),</span>
<span id="cb15-423"><a href="#cb15-423" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> GGally<span class="sc">::</span><span class="fu">wrap</span>(<span class="st">"points"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="fl">1.8</span>)),</span>
<span id="cb15-424"><a href="#cb15-424" aria-hidden="true" tabindex="-1"></a>  <span class="at">diag  =</span> <span class="fu">list</span>(<span class="at">continuous =</span> GGally<span class="sc">::</span><span class="fu">wrap</span>(<span class="st">"blankDiag"</span>))</span>
<span id="cb15-425"><a href="#cb15-425" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-426"><a href="#cb15-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-427"><a href="#cb15-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-428"><a href="#cb15-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-429"><a href="#cb15-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-430"><a href="#cb15-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-431"><a href="#cb15-431" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model building and Validation</span></span>
<span id="cb15-432"><a href="#cb15-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-433"><a href="#cb15-433" aria-hidden="true" tabindex="-1"></a><span class="fu">### Initial Modeling</span></span>
<span id="cb15-434"><a href="#cb15-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-435"><a href="#cb15-435" aria-hidden="true" tabindex="-1"></a>The first model I tried was a single variable model for all 3 Grades (A, B, and C), using each socioeconomic variable on its own. While these simple linear regression fits are useful to see the general relationships, the indicators are moderately to highly correlated to each other. Its likely that rent burned, unemployment, and poverty each contribute signal to grade outcomes. Modeling them jointly or through a composite index would probably get the pattern more reliable than a single variable. Just to make sure, I began with simple scatter plots and gave regression lines by grade. Grade A's given to restaurant generally decreases as economic stress increases, and grade B tends to rise. Grade c shows a smaller increase, but its much noisier.</span>
<span id="cb15-436"><a href="#cb15-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-439"><a href="#cb15-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-440"><a href="#cb15-440" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-show: hold</span></span>
<span id="cb15-441"><a href="#cb15-441" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb15-442"><a href="#cb15-442" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb15-443"><a href="#cb15-443" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: 100%</span></span>
<span id="cb15-444"><a href="#cb15-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb15-445"><a href="#cb15-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-446"><a href="#cb15-446" aria-hidden="true" tabindex="-1"></a>grades<span class="ot">&lt;-</span> combined_df<span class="sc">|&gt;</span></span>
<span id="cb15-447"><a href="#cb15-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(inspection_date)<span class="sc">&gt;=</span> <span class="dv">2021</span> <span class="sc">&amp;</span> <span class="fu">year</span>(inspection_date)<span class="sc">&lt;=</span> <span class="dv">2025</span> )<span class="sc">|&gt;</span></span>
<span id="cb15-448"><a href="#cb15-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id)<span class="sc">|&gt;</span></span>
<span id="cb15-449"><a href="#cb15-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb15-450"><a href="#cb15-450" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_restaurants =</span> <span class="fu">n</span>(),</span>
<span id="cb15-451"><a href="#cb15-451" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade_A_count =</span> <span class="fu">sum</span>(grade <span class="sc">==</span> <span class="st">"A"</span>),</span>
<span id="cb15-452"><a href="#cb15-452" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade_B_count =</span> <span class="fu">sum</span>(grade <span class="sc">==</span> <span class="st">"B"</span>),</span>
<span id="cb15-453"><a href="#cb15-453" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade_C_count =</span> <span class="fu">sum</span>(grade <span class="sc">==</span> <span class="st">"C"</span>),</span>
<span id="cb15-454"><a href="#cb15-454" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_score =</span> <span class="fu">mean</span>(score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-455"><a href="#cb15-455" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb15-456"><a href="#cb15-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(id))<span class="sc">|&gt;</span></span>
<span id="cb15-457"><a href="#cb15-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_grade_A =</span> grade_A_count <span class="sc">/</span> total_restaurants,</span>
<span id="cb15-458"><a href="#cb15-458" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_grade_B =</span> grade_B_count <span class="sc">/</span> total_restaurants,</span>
<span id="cb15-459"><a href="#cb15-459" aria-hidden="true" tabindex="-1"></a>         <span class="at">pct_grade_C =</span> grade_C_count <span class="sc">/</span> total_restaurants,</span>
<span id="cb15-460"><a href="#cb15-460" aria-hidden="true" tabindex="-1"></a>         <span class="at">nonA_count =</span> total_restaurants <span class="sc">-</span> grade_A_count</span>
<span id="cb15-461"><a href="#cb15-461" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb15-462"><a href="#cb15-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(combined_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>))<span class="sc">|&gt;</span></span>
<span id="cb15-463"><a href="#cb15-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-464"><a href="#cb15-464" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_z =</span> <span class="fu">scale</span>(rent_burden)[,<span class="dv">1</span>],</span>
<span id="cb15-465"><a href="#cb15-465" aria-hidden="true" tabindex="-1"></a>    <span class="at">poverty_z     =</span> <span class="fu">scale</span>(poverty)[,<span class="dv">1</span>],</span>
<span id="cb15-466"><a href="#cb15-466" aria-hidden="true" tabindex="-1"></a>    <span class="at">unemployment_z =</span> <span class="fu">scale</span>(unemployment)[,<span class="dv">1</span>]</span>
<span id="cb15-467"><a href="#cb15-467" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb15-468"><a href="#cb15-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)<span class="sc">|&gt;</span></span>
<span id="cb15-469"><a href="#cb15-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>grade, <span class="sc">-</span> score, <span class="sc">-</span>grade_date)</span>
<span id="cb15-470"><a href="#cb15-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-471"><a href="#cb15-471" aria-hidden="true" tabindex="-1"></a>grades_long<span class="ot">&lt;-</span> grades <span class="sc">|&gt;</span></span>
<span id="cb15-472"><a href="#cb15-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rent_burden, poverty, unemployment, pct_grade_A, pct_grade_B, pct_grade_C) <span class="sc">|&gt;</span></span>
<span id="cb15-473"><a href="#cb15-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb15-474"><a href="#cb15-474" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"pct_grade_"</span>),</span>
<span id="cb15-475"><a href="#cb15-475" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"grade"</span>,</span>
<span id="cb15-476"><a href="#cb15-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"pct"</span></span>
<span id="cb15-477"><a href="#cb15-477" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-478"><a href="#cb15-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-479"><a href="#cb15-479" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(grade,</span>
<span id="cb15-480"><a href="#cb15-480" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"pct_grade_A"</span> <span class="ot">=</span> <span class="st">"Grade A"</span>,</span>
<span id="cb15-481"><a href="#cb15-481" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"pct_grade_B"</span> <span class="ot">=</span> <span class="st">"Grade B"</span>,</span>
<span id="cb15-482"><a href="#cb15-482" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"pct_grade_C"</span> <span class="ot">=</span> <span class="st">"Grade C"</span>)</span>
<span id="cb15-483"><a href="#cb15-483" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-484"><a href="#cb15-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-485"><a href="#cb15-485" aria-hidden="true" tabindex="-1"></a>grades_long <span class="sc">|&gt;</span></span>
<span id="cb15-486"><a href="#cb15-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rent_burden, <span class="at">y =</span> pct)) <span class="sc">+</span></span>
<span id="cb15-487"><a href="#cb15-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb15-488"><a href="#cb15-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb15-489"><a href="#cb15-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-490"><a href="#cb15-490" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden vs % Grade"</span>,</span>
<span id="cb15-491"><a href="#cb15-491" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"% Rent Burden"</span>,</span>
<span id="cb15-492"><a href="#cb15-492" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% of Grade"</span></span>
<span id="cb15-493"><a href="#cb15-493" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-494"><a href="#cb15-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb15-495"><a href="#cb15-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grade, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span>   </span>
<span id="cb15-496"><a href="#cb15-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb15-497"><a href="#cb15-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-498"><a href="#cb15-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-499"><a href="#cb15-499" aria-hidden="true" tabindex="-1"></a>grades_long <span class="sc">|&gt;</span></span>
<span id="cb15-500"><a href="#cb15-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> poverty, <span class="at">y=</span> pct))<span class="sc">+</span></span>
<span id="cb15-501"><a href="#cb15-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-502"><a href="#cb15-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb15-503"><a href="#cb15-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span><span class="st">"poverty vs % Grade "</span>, </span>
<span id="cb15-504"><a href="#cb15-504" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"% poverty"</span>, </span>
<span id="cb15-505"><a href="#cb15-505" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"% of Grade"</span>)<span class="sc">+</span></span>
<span id="cb15-506"><a href="#cb15-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb15-507"><a href="#cb15-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grade, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb15-508"><a href="#cb15-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb15-509"><a href="#cb15-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-510"><a href="#cb15-510" aria-hidden="true" tabindex="-1"></a>grades_long <span class="sc">|&gt;</span></span>
<span id="cb15-511"><a href="#cb15-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> unemployment, <span class="at">y =</span> pct)) <span class="sc">+</span></span>
<span id="cb15-512"><a href="#cb15-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb15-513"><a href="#cb15-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb15-514"><a href="#cb15-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-515"><a href="#cb15-515" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden vs % Grade"</span>,</span>
<span id="cb15-516"><a href="#cb15-516" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"% Rent Burden"</span>,</span>
<span id="cb15-517"><a href="#cb15-517" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% of Grade"</span></span>
<span id="cb15-518"><a href="#cb15-518" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-519"><a href="#cb15-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb15-520"><a href="#cb15-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grade, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span>   </span>
<span id="cb15-521"><a href="#cb15-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb15-522"><a href="#cb15-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-523"><a href="#cb15-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-524"><a href="#cb15-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-525"><a href="#cb15-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-526"><a href="#cb15-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-527"><a href="#cb15-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-528"><a href="#cb15-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-529"><a href="#cb15-529" aria-hidden="true" tabindex="-1"></a><span class="fu">### Further Modeling and Validation</span></span>
<span id="cb15-530"><a href="#cb15-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-531"><a href="#cb15-531" aria-hidden="true" tabindex="-1"></a>decided to move on from single variables, so I constructed two citywide indices that summarize economic stress per district. The Equal weight Z index (EZI) standardizes each indicator to a z-score and averages them. A **higher** EZI essentially means **more economic stress** by an equal fraction of rent, poverty, and unemployment. I also built a Supervised Logistic Index (SLI) by fitting a binomial model for A versus non-A percentages on 3 z-scores, and used the coefficients as weights. Because SLI's weights are chosen to best predict the outcome, it tends to be more predictive. The orientation is different however, a **higher** SLI leads to **less economic stress** and/or a **higher predicted percentage** **of A's** because the direction is set by the learned weights.</span>
<span id="cb15-532"><a href="#cb15-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-535"><a href="#cb15-535" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-536"><a href="#cb15-536" aria-hidden="true" tabindex="-1"></a><span class="co">#|results: hold</span></span>
<span id="cb15-537"><a href="#cb15-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-538"><a href="#cb15-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-539"><a href="#cb15-539" aria-hidden="true" tabindex="-1"></a>district_metrics <span class="ot">&lt;-</span> ch_neighbor <span class="sc">|&gt;</span></span>
<span id="cb15-540"><a href="#cb15-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, rent_burden, poverty, unemployment) <span class="sc">|&gt;</span></span>
<span id="cb15-541"><a href="#cb15-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-542"><a href="#cb15-542" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_z =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(rent_burden)),</span>
<span id="cb15-543"><a href="#cb15-543" aria-hidden="true" tabindex="-1"></a>    <span class="at">pov_z  =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(poverty)),</span>
<span id="cb15-544"><a href="#cb15-544" aria-hidden="true" tabindex="-1"></a>    <span class="at">un_z   =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(unemployment)),</span>
<span id="cb15-545"><a href="#cb15-545" aria-hidden="true" tabindex="-1"></a>    <span class="at">EZI    =</span> (rent_z <span class="sc">+</span> pov_z <span class="sc">+</span> un_z) <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb15-546"><a href="#cb15-546" aria-hidden="true" tabindex="-1"></a>    <span class="at">EZI_z  =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(EZI)),</span>
<span id="cb15-547"><a href="#cb15-547" aria-hidden="true" tabindex="-1"></a>    <span class="at">EZI_100 =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(EZI, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb15-548"><a href="#cb15-548" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-549"><a href="#cb15-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-550"><a href="#cb15-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-551"><a href="#cb15-551" aria-hidden="true" tabindex="-1"></a>df_idx <span class="ot">&lt;-</span> grades <span class="sc">|&gt;</span></span>
<span id="cb15-552"><a href="#cb15-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb15-553"><a href="#cb15-553" aria-hidden="true" tabindex="-1"></a>    district_metrics <span class="sc">|&gt;</span> <span class="fu">select</span>(id, EZI_z, EZI_100, rent_z, pov_z, un_z),</span>
<span id="cb15-554"><a href="#cb15-554" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"id"</span></span>
<span id="cb15-555"><a href="#cb15-555" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-556"><a href="#cb15-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-557"><a href="#cb15-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-558"><a href="#cb15-558" aria-hidden="true" tabindex="-1"></a>m_sli_weights <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb15-559"><a href="#cb15-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(grade_A_count, total_restaurants <span class="sc">-</span> grade_A_count) <span class="sc">~</span> rent_z <span class="sc">+</span> pov_z <span class="sc">+</span> un_z,</span>
<span id="cb15-560"><a href="#cb15-560" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_idx, <span class="at">family =</span> binomial</span>
<span id="cb15-561"><a href="#cb15-561" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-562"><a href="#cb15-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-563"><a href="#cb15-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-564"><a href="#cb15-564" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">coef</span>(m_sli_weights)[<span class="fu">c</span>(<span class="st">"rent_z"</span>,<span class="st">"pov_z"</span>,<span class="st">"un_z"</span>)]</span>
<span id="cb15-565"><a href="#cb15-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-566"><a href="#cb15-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-567"><a href="#cb15-567" aria-hidden="true" tabindex="-1"></a>df_idx <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span></span>
<span id="cb15-568"><a href="#cb15-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-569"><a href="#cb15-569" aria-hidden="true" tabindex="-1"></a>    <span class="at">SLI_raw =</span> w[<span class="st">"rent_z"</span>]<span class="sc">*</span>rent_z <span class="sc">+</span> w[<span class="st">"pov_z"</span>]<span class="sc">*</span>pov_z <span class="sc">+</span> w[<span class="st">"un_z"</span>]<span class="sc">*</span>un_z,</span>
<span id="cb15-570"><a href="#cb15-570" aria-hidden="true" tabindex="-1"></a>    <span class="at">SLI_z   =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(SLI_raw)),</span>
<span id="cb15-571"><a href="#cb15-571" aria-hidden="true" tabindex="-1"></a>    <span class="at">SLI_100 =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(SLI_raw, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb15-572"><a href="#cb15-572" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-573"><a href="#cb15-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-574"><a href="#cb15-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-575"><a href="#cb15-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-576"><a href="#cb15-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-577"><a href="#cb15-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-578"><a href="#cb15-578" aria-hidden="true" tabindex="-1"></a>All grade models were fit as binomial GLMs using district‑level counts (e.g., <span class="in">`cbind(A_count, total – A_count)`</span>), which weights by district size and yields predictions on the probability scale, the percentage of restaurants. For each grade, I estimated multiple things, the first being univariate models for rent, poverty, and unemployment and the second a multiple model with all three indicators. Finally, I estimated multiple index‑based models with EZI or SLI alone. I then compared fits using AIC and McFadden’s pseudo‑R² . The comparison table shows a fairly consistent pattern. For Grade A, the SLI and multiple models deliver the best performance (AIC around 514–518 and R² ≈ 0.46), substantially improving on the EZI model (AIC ≈ 559, R² ≈ 0.33) and far outperforming unemployment alone (AIC ≈ 637, R² ≈ 0.11). For Grade B, the multiple specification stands out with an of AIC ≈ 427 and R² ≈ 0.51. Rent and poverty univariates are close behind, while the index models trail but still have most of the effect. Grade C generally follows B’s pattern but again has a weaker signal and wider uncertainty, so I am uncertain if Grade C will have significance in any of these models.</span>
<span id="cb15-579"><a href="#cb15-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-582"><a href="#cb15-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-583"><a href="#cb15-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hold</span></span>
<span id="cb15-584"><a href="#cb15-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-585"><a href="#cb15-585" aria-hidden="true" tabindex="-1"></a>fit_binom <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">grade =</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>), rhs) {</span>
<span id="cb15-586"><a href="#cb15-586" aria-hidden="true" tabindex="-1"></a>  grade <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(grade)</span>
<span id="cb15-587"><a href="#cb15-587" aria-hidden="true" tabindex="-1"></a>  y_s <span class="ot">&lt;-</span> <span class="cf">switch</span>(grade,</span>
<span id="cb15-588"><a href="#cb15-588" aria-hidden="true" tabindex="-1"></a>                <span class="at">A =</span> df<span class="sc">$</span>grade_A_count,</span>
<span id="cb15-589"><a href="#cb15-589" aria-hidden="true" tabindex="-1"></a>                <span class="at">B =</span> df<span class="sc">$</span>grade_B_count,</span>
<span id="cb15-590"><a href="#cb15-590" aria-hidden="true" tabindex="-1"></a>                <span class="at">C =</span> df<span class="sc">$</span>grade_C_count)</span>
<span id="cb15-591"><a href="#cb15-591" aria-hidden="true" tabindex="-1"></a>  y_f <span class="ot">&lt;-</span> df<span class="sc">$</span>total_restaurants <span class="sc">-</span> y_s</span>
<span id="cb15-592"><a href="#cb15-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(<span class="fu">cbind</span>(y_s, y_f) <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">cbind.data.frame</span>(rhs, y_s, y_f),</span>
<span id="cb15-593"><a href="#cb15-593" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial)</span>
<span id="cb15-594"><a href="#cb15-594" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-595"><a href="#cb15-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-596"><a href="#cb15-596" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictor sets</span></span>
<span id="cb15-597"><a href="#cb15-597" aria-hidden="true" tabindex="-1"></a>rhs_ezi   <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(EZI_z)</span>
<span id="cb15-598"><a href="#cb15-598" aria-hidden="true" tabindex="-1"></a>rhs_sli   <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(SLI_z)</span>
<span id="cb15-599"><a href="#cb15-599" aria-hidden="true" tabindex="-1"></a>rhs_uni_rb<span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(rent_z)</span>
<span id="cb15-600"><a href="#cb15-600" aria-hidden="true" tabindex="-1"></a>rhs_uni_p <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(pov_z)</span>
<span id="cb15-601"><a href="#cb15-601" aria-hidden="true" tabindex="-1"></a>rhs_uni_u <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(un_z)</span>
<span id="cb15-602"><a href="#cb15-602" aria-hidden="true" tabindex="-1"></a>rhs_multi <span class="ot">&lt;-</span> df_idx <span class="sc">|&gt;</span> <span class="fu">select</span>(rent_z, pov_z, un_z)</span>
<span id="cb15-603"><a href="#cb15-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-604"><a href="#cb15-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-605"><a href="#cb15-605" aria-hidden="true" tabindex="-1"></a>mods <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb15-606"><a href="#cb15-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-607"><a href="#cb15-607" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_ezi   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_ezi),</span>
<span id="cb15-608"><a href="#cb15-608" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_sli   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_sli),</span>
<span id="cb15-609"><a href="#cb15-609" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_rb    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_uni_rb),</span>
<span id="cb15-610"><a href="#cb15-610" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_pov   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_uni_p),</span>
<span id="cb15-611"><a href="#cb15-611" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_un    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_uni_u),</span>
<span id="cb15-612"><a href="#cb15-612" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_multi =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"A"</span>, rhs_multi),</span>
<span id="cb15-613"><a href="#cb15-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-614"><a href="#cb15-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-615"><a href="#cb15-615" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_ezi   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_ezi),</span>
<span id="cb15-616"><a href="#cb15-616" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_sli   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_sli),</span>
<span id="cb15-617"><a href="#cb15-617" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_rb    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_uni_rb),</span>
<span id="cb15-618"><a href="#cb15-618" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_pov   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_uni_p),</span>
<span id="cb15-619"><a href="#cb15-619" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_un    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_uni_u),</span>
<span id="cb15-620"><a href="#cb15-620" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_multi =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"B"</span>, rhs_multi),</span>
<span id="cb15-621"><a href="#cb15-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-622"><a href="#cb15-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-623"><a href="#cb15-623" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_ezi   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_ezi),</span>
<span id="cb15-624"><a href="#cb15-624" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_sli   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_sli),</span>
<span id="cb15-625"><a href="#cb15-625" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_rb    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_uni_rb),</span>
<span id="cb15-626"><a href="#cb15-626" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_pov   =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_uni_p),</span>
<span id="cb15-627"><a href="#cb15-627" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_un    =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_uni_u),</span>
<span id="cb15-628"><a href="#cb15-628" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_multi =</span> <span class="fu">fit_binom</span>(df_idx, <span class="st">"C"</span>, rhs_multi)</span>
<span id="cb15-629"><a href="#cb15-629" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-630"><a href="#cb15-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-631"><a href="#cb15-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-632"><a href="#cb15-632" aria-hidden="true" tabindex="-1"></a>pseudoR2 <span class="ot">&lt;-</span> <span class="cf">function</span>(m) <span class="dv">1</span> <span class="sc">-</span> (m<span class="sc">$</span>deviance <span class="sc">/</span> m<span class="sc">$</span>null.deviance)</span>
<span id="cb15-633"><a href="#cb15-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-634"><a href="#cb15-634" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb15-635"><a href="#cb15-635" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">names</span>(mods),</span>
<span id="cb15-636"><a href="#cb15-636" aria-hidden="true" tabindex="-1"></a>  <span class="at">AIC   =</span> <span class="fu">sapply</span>(mods, AIC),</span>
<span id="cb15-637"><a href="#cb15-637" aria-hidden="true" tabindex="-1"></a>  <span class="at">McFadden_R2 =</span> <span class="fu">sapply</span>(mods, pseudoR2)</span>
<span id="cb15-638"><a href="#cb15-638" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb15-639"><a href="#cb15-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(model)</span>
<span id="cb15-640"><a href="#cb15-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-641"><a href="#cb15-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-642"><a href="#cb15-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-643"><a href="#cb15-643" aria-hidden="true" tabindex="-1"></a>model_summary<span class="ot">&lt;-</span> model_summary <span class="sc">|&gt;</span></span>
<span id="cb15-644"><a href="#cb15-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-645"><a href="#cb15-645" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> <span class="fu">str_extract</span>(model, <span class="st">"^[ABC]"</span>),</span>
<span id="cb15-646"><a href="#cb15-646" aria-hidden="true" tabindex="-1"></a>    <span class="at">spec  =</span> <span class="fu">str_replace</span>(model, <span class="st">"^[ABC]_"</span>,<span class="st">""</span>)</span>
<span id="cb15-647"><a href="#cb15-647" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-648"><a href="#cb15-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-649"><a href="#cb15-649" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> <span class="fu">recode</span>(grade,</span>
<span id="cb15-650"><a href="#cb15-650" aria-hidden="true" tabindex="-1"></a>      <span class="st">"A"</span> <span class="ot">=</span> <span class="st">"Grade A"</span>,</span>
<span id="cb15-651"><a href="#cb15-651" aria-hidden="true" tabindex="-1"></a>      <span class="st">"B"</span> <span class="ot">=</span> <span class="st">"Grade B"</span>,</span>
<span id="cb15-652"><a href="#cb15-652" aria-hidden="true" tabindex="-1"></a>      <span class="st">"C"</span> <span class="ot">=</span> <span class="st">"Grade C"</span></span>
<span id="cb15-653"><a href="#cb15-653" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-654"><a href="#cb15-654" aria-hidden="true" tabindex="-1"></a>    <span class="at">spec =</span> <span class="fu">recode</span>(spec,</span>
<span id="cb15-655"><a href="#cb15-655" aria-hidden="true" tabindex="-1"></a>      <span class="st">"ezi"</span>   <span class="ot">=</span> <span class="st">"EZI (equal‑weight index)"</span>,</span>
<span id="cb15-656"><a href="#cb15-656" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sli"</span>   <span class="ot">=</span> <span class="st">"SLI (supervised index)"</span>,</span>
<span id="cb15-657"><a href="#cb15-657" aria-hidden="true" tabindex="-1"></a>      <span class="st">"multi"</span> <span class="ot">=</span> <span class="st">"Multiple (rent + poverty + unemployment)"</span>,</span>
<span id="cb15-658"><a href="#cb15-658" aria-hidden="true" tabindex="-1"></a>      <span class="st">"rb"</span>    <span class="ot">=</span> <span class="st">"Rent burden only"</span>,</span>
<span id="cb15-659"><a href="#cb15-659" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pov"</span>   <span class="ot">=</span> <span class="st">"Poverty only"</span>,</span>
<span id="cb15-660"><a href="#cb15-660" aria-hidden="true" tabindex="-1"></a>      <span class="st">"un"</span>    <span class="ot">=</span> <span class="st">"Unemployment only"</span></span>
<span id="cb15-661"><a href="#cb15-661" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-662"><a href="#cb15-662" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">|&gt;</span></span>
<span id="cb15-663"><a href="#cb15-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grade, spec, AIC, McFadden_R2) <span class="sc">|&gt;</span></span>
<span id="cb15-664"><a href="#cb15-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(grade, AIC)</span>
<span id="cb15-665"><a href="#cb15-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-666"><a href="#cb15-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-667"><a href="#cb15-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-668"><a href="#cb15-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-669"><a href="#cb15-669" aria-hidden="true" tabindex="-1"></a>aic_wide <span class="ot">&lt;-</span> model_summary <span class="sc">|&gt;</span></span>
<span id="cb15-670"><a href="#cb15-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grade, spec, AIC) <span class="sc">|&gt;</span></span>
<span id="cb15-671"><a href="#cb15-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> grade, <span class="at">values_from =</span> AIC)</span>
<span id="cb15-672"><a href="#cb15-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-673"><a href="#cb15-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-674"><a href="#cb15-674" aria-hidden="true" tabindex="-1"></a>r2_wide <span class="ot">&lt;-</span> model_summary <span class="sc">|&gt;</span></span>
<span id="cb15-675"><a href="#cb15-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grade, spec, McFadden_R2) <span class="sc">|&gt;</span></span>
<span id="cb15-676"><a href="#cb15-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> grade, <span class="at">values_from =</span> McFadden_R2)</span>
<span id="cb15-677"><a href="#cb15-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-678"><a href="#cb15-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-679"><a href="#cb15-679" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(aic_wide, <span class="at">caption =</span> <span class="st">"AIC Model comparison"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>))<span class="sc">|&gt;</span> </span>
<span id="cb15-680"><a href="#cb15-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb15-681"><a href="#cb15-681" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"condensed"</span>))</span>
<span id="cb15-682"><a href="#cb15-682" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb15-683"><a href="#cb15-683" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(r2_wide, <span class="at">caption =</span> <span class="st">"McFadden R² Model comparison"</span>, <span class="at">digits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>))<span class="sc">|&gt;</span> </span>
<span id="cb15-684"><a href="#cb15-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb15-685"><a href="#cb15-685" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"condensed"</span>))</span>
<span id="cb15-686"><a href="#cb15-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-687"><a href="#cb15-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-688"><a href="#cb15-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-689"><a href="#cb15-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-690"><a href="#cb15-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-691"><a href="#cb15-691" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plotting the Model</span></span>
<span id="cb15-692"><a href="#cb15-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-693"><a href="#cb15-693" aria-hidden="true" tabindex="-1"></a>I wanted to show a plot that might be easier to interpret, though that is always hard to do with z-scores. Its an unfortunate situation where the model calls for either z-scores, logistic scaling, or some other transformation so it wont have multicollinearity. I plotted citywide prediction curves for EZI and SLI with 95% confidence bands on the response scale. The EZI plot shows a clear trade‑off: as stress rises, the share of A‑grade restaurants declines steadily, while B and C both increase (B more than C). The SLI plot shows the mirror image because SLI was learned from A where moving “up” the SLI scale (less stress / stronger A signal) raises A and lowers grade B and grade C. EZI is a bit easier easy to explain, while SLI is optimized for prediction and matches the grade distribution much better.</span>
<span id="cb15-694"><a href="#cb15-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-697"><a href="#cb15-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-698"><a href="#cb15-698" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-show: hold</span></span>
<span id="cb15-699"><a href="#cb15-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-700"><a href="#cb15-700" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df_idx<span class="sc">$</span>EZI_z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-701"><a href="#cb15-701" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(df_idx<span class="sc">$</span>EZI_z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> <span class="dv">300</span>)</span>
<span id="cb15-702"><a href="#cb15-702" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">EZI_z =</span> x_seq)</span>
<span id="cb15-703"><a href="#cb15-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-704"><a href="#cb15-704" aria-hidden="true" tabindex="-1"></a><span class="co"># Binomial predictions and CIs</span></span>
<span id="cb15-705"><a href="#cb15-705" aria-hidden="true" tabindex="-1"></a>pred_A <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>A_ezi, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-706"><a href="#cb15-706" aria-hidden="true" tabindex="-1"></a>pred_B <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>B_ezi, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-707"><a href="#cb15-707" aria-hidden="true" tabindex="-1"></a>pred_C <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>C_ezi, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-708"><a href="#cb15-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-709"><a href="#cb15-709" aria-hidden="true" tabindex="-1"></a>plot_curves <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb15-710"><a href="#cb15-710" aria-hidden="true" tabindex="-1"></a>  <span class="at">EZI_z =</span> x_seq,</span>
<span id="cb15-711"><a href="#cb15-711" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_hat =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit),</span>
<span id="cb15-712"><a href="#cb15-712" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_lwr =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_A<span class="sc">$</span>se.fit),</span>
<span id="cb15-713"><a href="#cb15-713" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_upr =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_A<span class="sc">$</span>se.fit),</span>
<span id="cb15-714"><a href="#cb15-714" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_hat =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit),</span>
<span id="cb15-715"><a href="#cb15-715" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_lwr =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_B<span class="sc">$</span>se.fit),</span>
<span id="cb15-716"><a href="#cb15-716" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_upr =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_B<span class="sc">$</span>se.fit),</span>
<span id="cb15-717"><a href="#cb15-717" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_hat =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit),</span>
<span id="cb15-718"><a href="#cb15-718" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_lwr =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_C<span class="sc">$</span>se.fit),</span>
<span id="cb15-719"><a href="#cb15-719" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_upr =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_C<span class="sc">$</span>se.fit)</span>
<span id="cb15-720"><a href="#cb15-720" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb15-721"><a href="#cb15-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>EZI_z,</span>
<span id="cb15-722"><a href="#cb15-722" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"grade"</span>,<span class="st">"stat"</span>),</span>
<span id="cb15-723"><a href="#cb15-723" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb15-724"><a href="#cb15-724" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-725"><a href="#cb15-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat, <span class="at">values_from =</span> value)</span>
<span id="cb15-726"><a href="#cb15-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-727"><a href="#cb15-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-728"><a href="#cb15-728" aria-hidden="true" tabindex="-1"></a>plot_curves_faceted <span class="ot">&lt;-</span> plot_curves <span class="sc">|&gt;</span></span>
<span id="cb15-729"><a href="#cb15-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-730"><a href="#cb15-730" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> <span class="fu">factor</span>(grade, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>),</span>
<span id="cb15-731"><a href="#cb15-731" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span>,<span class="st">"Grade B"</span>,<span class="st">"Grade C"</span>))</span>
<span id="cb15-732"><a href="#cb15-732" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-733"><a href="#cb15-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-734"><a href="#cb15-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-735"><a href="#cb15-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-736"><a href="#cb15-736" aria-hidden="true" tabindex="-1"></a>plot_curves_faceted<span class="sc">|&gt;</span></span>
<span id="cb15-737"><a href="#cb15-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(EZI_z, hat)) <span class="sc">+</span></span>
<span id="cb15-738"><a href="#cb15-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr, <span class="at">fill =</span> grade), <span class="at">alpha =</span> <span class="fl">0.20</span>) <span class="sc">+</span></span>
<span id="cb15-739"><a href="#cb15-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> grade), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb15-740"><a href="#cb15-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grade, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb15-741"><a href="#cb15-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span> <span class="ot">=</span> <span class="st">"#2C7FB8"</span>,</span>
<span id="cb15-742"><a href="#cb15-742" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Grade B"</span> <span class="ot">=</span> <span class="st">"#F28E2B"</span>,</span>
<span id="cb15-743"><a href="#cb15-743" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Grade C"</span> <span class="ot">=</span> <span class="st">"#E15759"</span>)) <span class="sc">+</span></span>
<span id="cb15-744"><a href="#cb15-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span> <span class="ot">=</span> <span class="st">"#2C7FB8"</span>,</span>
<span id="cb15-745"><a href="#cb15-745" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Grade B"</span> <span class="ot">=</span> <span class="st">"#F28E2B"</span>,</span>
<span id="cb15-746"><a href="#cb15-746" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Grade C"</span> <span class="ot">=</span> <span class="st">"#E15759"</span>)) <span class="sc">+</span></span>
<span id="cb15-747"><a href="#cb15-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb15-748"><a href="#cb15-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-749"><a href="#cb15-749" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Citywide predicted share by grade vs Economic Stress (EZI)"</span>,</span>
<span id="cb15-750"><a href="#cb15-750" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"One panel per grade; shaded bands are 95% CIs"</span>,</span>
<span id="cb15-751"><a href="#cb15-751" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"EZI (z-score across districts)"</span>,</span>
<span id="cb15-752"><a href="#cb15-752" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% of restaurants"</span></span>
<span id="cb15-753"><a href="#cb15-753" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-754"><a href="#cb15-754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb15-755"><a href="#cb15-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb15-756"><a href="#cb15-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-757"><a href="#cb15-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-758"><a href="#cb15-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-759"><a href="#cb15-759" aria-hidden="true" tabindex="-1"></a><span class="co"># SLI</span></span>
<span id="cb15-760"><a href="#cb15-760" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df_idx<span class="sc">$</span>SLI_z , <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-761"><a href="#cb15-761" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(df_idx<span class="sc">$</span>SLI_z , <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">length.out =</span> <span class="dv">300</span>)</span>
<span id="cb15-762"><a href="#cb15-762" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SLI_z  =</span> x_seq)</span>
<span id="cb15-763"><a href="#cb15-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-764"><a href="#cb15-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-765"><a href="#cb15-765" aria-hidden="true" tabindex="-1"></a>pred_A <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>A_sli, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-766"><a href="#cb15-766" aria-hidden="true" tabindex="-1"></a>pred_B <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>B_sli, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-767"><a href="#cb15-767" aria-hidden="true" tabindex="-1"></a>pred_C <span class="ot">&lt;-</span> <span class="fu">predict</span>(mods<span class="sc">$</span>C_sli, <span class="at">newdata =</span> pred_df, <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-768"><a href="#cb15-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-769"><a href="#cb15-769" aria-hidden="true" tabindex="-1"></a>plot_curves2 <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb15-770"><a href="#cb15-770" aria-hidden="true" tabindex="-1"></a>  <span class="at">SLI_z  =</span> x_seq,</span>
<span id="cb15-771"><a href="#cb15-771" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_hat =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit),</span>
<span id="cb15-772"><a href="#cb15-772" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_lwr =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_A<span class="sc">$</span>se.fit),</span>
<span id="cb15-773"><a href="#cb15-773" aria-hidden="true" tabindex="-1"></a>  <span class="at">A_upr =</span> <span class="fu">plogis</span>(pred_A<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_A<span class="sc">$</span>se.fit),</span>
<span id="cb15-774"><a href="#cb15-774" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_hat =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit),</span>
<span id="cb15-775"><a href="#cb15-775" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_lwr =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_B<span class="sc">$</span>se.fit),</span>
<span id="cb15-776"><a href="#cb15-776" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_upr =</span> <span class="fu">plogis</span>(pred_B<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_B<span class="sc">$</span>se.fit),</span>
<span id="cb15-777"><a href="#cb15-777" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_hat =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit),</span>
<span id="cb15-778"><a href="#cb15-778" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_lwr =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_C<span class="sc">$</span>se.fit),</span>
<span id="cb15-779"><a href="#cb15-779" aria-hidden="true" tabindex="-1"></a>  <span class="at">C_upr =</span> <span class="fu">plogis</span>(pred_C<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred_C<span class="sc">$</span>se.fit)</span>
<span id="cb15-780"><a href="#cb15-780" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb15-781"><a href="#cb15-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>SLI_z ,</span>
<span id="cb15-782"><a href="#cb15-782" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"grade"</span>,<span class="st">"stat"</span>),</span>
<span id="cb15-783"><a href="#cb15-783" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb15-784"><a href="#cb15-784" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-785"><a href="#cb15-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat, <span class="at">values_from =</span> value)</span>
<span id="cb15-786"><a href="#cb15-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-787"><a href="#cb15-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-788"><a href="#cb15-788" aria-hidden="true" tabindex="-1"></a>plot_curves_faceted2 <span class="ot">&lt;-</span> plot_curves2 <span class="sc">|&gt;</span></span>
<span id="cb15-789"><a href="#cb15-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-790"><a href="#cb15-790" aria-hidden="true" tabindex="-1"></a>    <span class="at">grade =</span> <span class="fu">factor</span>(grade, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>),</span>
<span id="cb15-791"><a href="#cb15-791" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span>,<span class="st">"Grade B"</span>,<span class="st">"Grade C"</span>))</span>
<span id="cb15-792"><a href="#cb15-792" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-793"><a href="#cb15-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-794"><a href="#cb15-794" aria-hidden="true" tabindex="-1"></a>plot_curves_faceted2<span class="sc">|&gt;</span></span>
<span id="cb15-795"><a href="#cb15-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(SLI_z , hat)) <span class="sc">+</span></span>
<span id="cb15-796"><a href="#cb15-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr, <span class="at">ymax =</span> upr, <span class="at">fill =</span> grade), <span class="at">alpha =</span> <span class="fl">0.20</span>) <span class="sc">+</span></span>
<span id="cb15-797"><a href="#cb15-797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> grade), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb15-798"><a href="#cb15-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> grade, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb15-799"><a href="#cb15-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span> <span class="ot">=</span> <span class="st">"#2C7FB8"</span>,</span>
<span id="cb15-800"><a href="#cb15-800" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Grade B"</span> <span class="ot">=</span> <span class="st">"#F28E2B"</span>,</span>
<span id="cb15-801"><a href="#cb15-801" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Grade C"</span> <span class="ot">=</span> <span class="st">"#E15759"</span>)) <span class="sc">+</span></span>
<span id="cb15-802"><a href="#cb15-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Grade A"</span> <span class="ot">=</span> <span class="st">"#2C7FB8"</span>,</span>
<span id="cb15-803"><a href="#cb15-803" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Grade B"</span> <span class="ot">=</span> <span class="st">"#F28E2B"</span>,</span>
<span id="cb15-804"><a href="#cb15-804" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Grade C"</span> <span class="ot">=</span> <span class="st">"#E15759"</span>)) <span class="sc">+</span></span>
<span id="cb15-805"><a href="#cb15-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb15-806"><a href="#cb15-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-807"><a href="#cb15-807" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Citywide predicted share by grade vs Economic Stress (SLI)"</span>,</span>
<span id="cb15-808"><a href="#cb15-808" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Single curves per grade; shaded bands are 95% CIs"</span>,</span>
<span id="cb15-809"><a href="#cb15-809" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"SLI (z-score across districts)"</span>,</span>
<span id="cb15-810"><a href="#cb15-810" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"% of restaurants"</span></span>
<span id="cb15-811"><a href="#cb15-811" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb15-812"><a href="#cb15-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb15-813"><a href="#cb15-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb15-814"><a href="#cb15-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-815"><a href="#cb15-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-816"><a href="#cb15-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-817"><a href="#cb15-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-818"><a href="#cb15-818" aria-hidden="true" tabindex="-1"></a>Across grades, the index specifications (EZI and SLI) yield statistically meaningful effects, while the multiple model’s individual indicators are noisier and largely non‑significant. In the Grade A model, a 1‑SD increase in EZI (more economic stress) is associated with a decrease in the log‑odds of receiving Grade A (β = −0.148, *p* ≈ 0). Conversely, a 1‑SD increase in SLI (less stress/higher predicted A) is positive (β = 0.163, *p* ≈ 0). The multiple model’s rent burden, poverty, and unemployment terms are individually non‑significant for Grade A. For Grade B, the pattern mirrors Grade A: EZI is positive (β = 0.161, SE = 0.029, *z* = 5.59, *p* ≈ 0) and SLI is negative (β = −0.173, *p* ≈ 0), while separate rent, poverty, and unemployment terms do not reach significance. Finally, for Grade C, the signal is weaker but directionally consistent: EZI is positive (β = 0.095, *p* = 0.00149) and SLI is negative (β = −0.115, *p* = 0.00281). The multiple model’s three indicators again appear individually non‑significant.</span>
<span id="cb15-819"><a href="#cb15-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-822"><a href="#cb15-822" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-823"><a href="#cb15-823" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hold</span></span>
<span id="cb15-824"><a href="#cb15-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-825"><a href="#cb15-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-826"><a href="#cb15-826" aria-hidden="true" tabindex="-1"></a>tidy_wald <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">terms =</span> <span class="cn">NULL</span>, <span class="at">robust =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">"HC1"</span>) {</span>
<span id="cb15-827"><a href="#cb15-827" aria-hidden="true" tabindex="-1"></a>  est <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod)</span>
<span id="cb15-828"><a href="#cb15-828" aria-hidden="true" tabindex="-1"></a>  <span class="co"># robust vs classical variance-covariance</span></span>
<span id="cb15-829"><a href="#cb15-829" aria-hidden="true" tabindex="-1"></a>  V   <span class="ot">&lt;-</span> <span class="cf">if</span> (robust) sandwich<span class="sc">::</span><span class="fu">vcovHC</span>(mod, <span class="at">type =</span> type) <span class="cf">else</span> <span class="fu">vcov</span>(mod)</span>
<span id="cb15-830"><a href="#cb15-830" aria-hidden="true" tabindex="-1"></a>  se  <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(V))</span>
<span id="cb15-831"><a href="#cb15-831" aria-hidden="true" tabindex="-1"></a>  z   <span class="ot">&lt;-</span> est <span class="sc">/</span> se</span>
<span id="cb15-832"><a href="#cb15-832" aria-hidden="true" tabindex="-1"></a>  p   <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(z), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-833"><a href="#cb15-833" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-834"><a href="#cb15-834" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb15-835"><a href="#cb15-835" aria-hidden="true" tabindex="-1"></a>    <span class="at">term      =</span> <span class="fu">names</span>(est),</span>
<span id="cb15-836"><a href="#cb15-836" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate  =</span> <span class="fu">as.numeric</span>(est),</span>
<span id="cb15-837"><a href="#cb15-837" aria-hidden="true" tabindex="-1"></a>    <span class="at">std.error =</span> <span class="fu">as.numeric</span>(se),</span>
<span id="cb15-838"><a href="#cb15-838" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">as.numeric</span>(z),</span>
<span id="cb15-839"><a href="#cb15-839" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value   =</span> <span class="fu">as.numeric</span>(p)</span>
<span id="cb15-840"><a href="#cb15-840" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-841"><a href="#cb15-841" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(terms)) out <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(out, term <span class="sc">%in%</span> terms)</span>
<span id="cb15-842"><a href="#cb15-842" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb15-843"><a href="#cb15-843" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-844"><a href="#cb15-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-845"><a href="#cb15-845" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: safely pull one term; returns empty tibble if missing</span></span>
<span id="cb15-846"><a href="#cb15-846" aria-hidden="true" tabindex="-1"></a>tidy_wald_term <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, term, <span class="at">robust =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">"HC1"</span>) {</span>
<span id="cb15-847"><a href="#cb15-847" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">tidy_wald</span>(mod, <span class="at">robust =</span> robust, <span class="at">type =</span> type)</span>
<span id="cb15-848"><a href="#cb15-848" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(res, .data<span class="sc">$</span>term <span class="sc">==</span> term)</span>
<span id="cb15-849"><a href="#cb15-849" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-850"><a href="#cb15-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-851"><a href="#cb15-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-852"><a href="#cb15-852" aria-hidden="true" tabindex="-1"></a><span class="co"># EZI_z for A/B/C</span></span>
<span id="cb15-853"><a href="#cb15-853" aria-hidden="true" tabindex="-1"></a>p_ezi <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb15-854"><a href="#cb15-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>A_ezi, <span class="st">"EZI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-855"><a href="#cb15-855" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade A"</span>, <span class="at">spec =</span> <span class="st">"EZI"</span>),</span>
<span id="cb15-856"><a href="#cb15-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>B_ezi, <span class="st">"EZI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-857"><a href="#cb15-857" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade B"</span>, <span class="at">spec =</span> <span class="st">"EZI"</span>),</span>
<span id="cb15-858"><a href="#cb15-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>C_ezi, <span class="st">"EZI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-859"><a href="#cb15-859" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade C"</span>, <span class="at">spec =</span> <span class="st">"EZI"</span>)</span>
<span id="cb15-860"><a href="#cb15-860" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-861"><a href="#cb15-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-862"><a href="#cb15-862" aria-hidden="true" tabindex="-1"></a><span class="co"># SLI_z for A/B/C</span></span>
<span id="cb15-863"><a href="#cb15-863" aria-hidden="true" tabindex="-1"></a>p_sli <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb15-864"><a href="#cb15-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>A_sli, <span class="st">"SLI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-865"><a href="#cb15-865" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade A"</span>, <span class="at">spec =</span> <span class="st">"SLI"</span>),</span>
<span id="cb15-866"><a href="#cb15-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>B_sli, <span class="st">"SLI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-867"><a href="#cb15-867" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade B"</span>, <span class="at">spec =</span> <span class="st">"SLI"</span>),</span>
<span id="cb15-868"><a href="#cb15-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald_term</span>(mods<span class="sc">$</span>C_sli, <span class="st">"SLI_z"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-869"><a href="#cb15-869" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade C"</span>, <span class="at">spec =</span> <span class="st">"SLI"</span>)</span>
<span id="cb15-870"><a href="#cb15-870" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-871"><a href="#cb15-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-872"><a href="#cb15-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-873"><a href="#cb15-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-874"><a href="#cb15-874" aria-hidden="true" tabindex="-1"></a>p_multi <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb15-875"><a href="#cb15-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald</span>(mods<span class="sc">$</span>A_multi, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"rent_z"</span>,<span class="st">"pov_z"</span>,<span class="st">"un_z"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-876"><a href="#cb15-876" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade A"</span>, <span class="at">spec =</span> <span class="st">"Multiple"</span>),</span>
<span id="cb15-877"><a href="#cb15-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald</span>(mods<span class="sc">$</span>B_multi, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"rent_z"</span>,<span class="st">"pov_z"</span>,<span class="st">"un_z"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-878"><a href="#cb15-878" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade B"</span>, <span class="at">spec =</span> <span class="st">"Multiple"</span>),</span>
<span id="cb15-879"><a href="#cb15-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_wald</span>(mods<span class="sc">$</span>C_multi, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"rent_z"</span>,<span class="st">"pov_z"</span>,<span class="st">"un_z"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-880"><a href="#cb15-880" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">grade =</span> <span class="st">"Grade C"</span>, <span class="at">spec =</span> <span class="st">"Multiple"</span>))</span>
<span id="cb15-881"><a href="#cb15-881" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-882"><a href="#cb15-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-883"><a href="#cb15-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-884"><a href="#cb15-884" aria-hidden="true" tabindex="-1"></a>p_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(p_ezi, p_sli, p_multi) <span class="sc">%&gt;%</span></span>
<span id="cb15-885"><a href="#cb15-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(grade, spec, term, estimate, std.error, statistic, p.value) <span class="sc">%&gt;%</span></span>
<span id="cb15-886"><a href="#cb15-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-887"><a href="#cb15-887" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate  =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>),</span>
<span id="cb15-888"><a href="#cb15-888" aria-hidden="true" tabindex="-1"></a>    <span class="at">std.error =</span> <span class="fu">round</span>(std.error, <span class="dv">3</span>),</span>
<span id="cb15-889"><a href="#cb15-889" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">round</span>(statistic, <span class="dv">3</span>),</span>
<span id="cb15-890"><a href="#cb15-890" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value   =</span> <span class="fu">signif</span>(p.value, <span class="dv">3</span>)   <span class="co"># or round(p.value, 3)</span></span>
<span id="cb15-891"><a href="#cb15-891" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-892"><a href="#cb15-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(grade, spec, term)</span>
<span id="cb15-893"><a href="#cb15-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-894"><a href="#cb15-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-895"><a href="#cb15-895" aria-hidden="true" tabindex="-1"></a>p_all <span class="sc">|&gt;</span></span>
<span id="cb15-896"><a href="#cb15-896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-897"><a href="#cb15-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-898"><a href="#cb15-898" aria-hidden="true" tabindex="-1"></a>    <span class="at">spec =</span> <span class="fu">recode</span>(spec,</span>
<span id="cb15-899"><a href="#cb15-899" aria-hidden="true" tabindex="-1"></a>      <span class="st">"EZI"</span>     <span class="ot">=</span> <span class="st">"EZI (equal-weight index)"</span>,</span>
<span id="cb15-900"><a href="#cb15-900" aria-hidden="true" tabindex="-1"></a>      <span class="st">"SLI"</span>     <span class="ot">=</span> <span class="st">"SLI (supervised index)"</span>,</span>
<span id="cb15-901"><a href="#cb15-901" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Multiple"</span><span class="ot">=</span> <span class="st">"Multiple (rent + poverty + unemployment)"</span></span>
<span id="cb15-902"><a href="#cb15-902" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-903"><a href="#cb15-903" aria-hidden="true" tabindex="-1"></a>    <span class="at">term =</span> <span class="fu">recode</span>(term,</span>
<span id="cb15-904"><a href="#cb15-904" aria-hidden="true" tabindex="-1"></a>      <span class="st">"EZI_z"</span> <span class="ot">=</span> <span class="st">"EZI (per 1 SD)"</span>,</span>
<span id="cb15-905"><a href="#cb15-905" aria-hidden="true" tabindex="-1"></a>      <span class="st">"SLI_z"</span> <span class="ot">=</span> <span class="st">"SLI (per 1 SD)"</span>,</span>
<span id="cb15-906"><a href="#cb15-906" aria-hidden="true" tabindex="-1"></a>      <span class="st">"rent_z"</span><span class="ot">=</span> <span class="st">"Rent burden (per 1 SD)"</span>,</span>
<span id="cb15-907"><a href="#cb15-907" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pov_z"</span> <span class="ot">=</span> <span class="st">"Poverty (per 1 SD)"</span>,</span>
<span id="cb15-908"><a href="#cb15-908" aria-hidden="true" tabindex="-1"></a>      <span class="st">"un_z"</span>  <span class="ot">=</span> <span class="st">"Unemployment (per 1 SD)"</span></span>
<span id="cb15-909"><a href="#cb15-909" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-910"><a href="#cb15-910" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate  =</span> <span class="fu">round</span>(estimate, <span class="dv">3</span>),</span>
<span id="cb15-911"><a href="#cb15-911" aria-hidden="true" tabindex="-1"></a>    <span class="at">std.error =</span> <span class="fu">round</span>(std.error, <span class="dv">3</span>),</span>
<span id="cb15-912"><a href="#cb15-912" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">round</span>(statistic, <span class="dv">3</span>),</span>
<span id="cb15-913"><a href="#cb15-913" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value   =</span> <span class="fu">signif</span>(p.value, <span class="dv">3</span>)</span>
<span id="cb15-914"><a href="#cb15-914" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-915"><a href="#cb15-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(grade, spec, term)<span class="sc">|&gt;</span></span>
<span id="cb15-916"><a href="#cb15-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(</span>
<span id="cb15-917"><a href="#cb15-917" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Grade"</span>,<span class="st">"Model"</span>,<span class="st">"Term"</span>,<span class="st">"Estimate"</span>,</span>
<span id="cb15-918"><a href="#cb15-918" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"SE (robust)"</span>,<span class="st">"z"</span>,<span class="st">"p-value"</span>),</span>
<span id="cb15-919"><a href="#cb15-919" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"l"</span>,<span class="st">"r"</span>,<span class="st">"r"</span>,<span class="st">"r"</span>,<span class="st">"r"</span>),</span>
<span id="cb15-920"><a href="#cb15-920" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Per-coefficient Wald tests (HC1 robust SEs)"</span></span>
<span id="cb15-921"><a href="#cb15-921" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-922"><a href="#cb15-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb15-923"><a href="#cb15-923" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>,<span class="st">"condensed"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-924"><a href="#cb15-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">"top"</span>)</span>
<span id="cb15-925"><a href="#cb15-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-926"><a href="#cb15-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-927"><a href="#cb15-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-928"><a href="#cb15-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-929"><a href="#cb15-929" aria-hidden="true" tabindex="-1"></a>While coefficients are reported on the log‑odds scale, I want to convey is that there is movement in the likelyhood of grades changing as neighborhood stress shifts. For example, with Grade A the EZI effect (β = −0.148) translates to an odds ratio of approximately 0.86, which is about a 14% reduction in the odds of an A for a one‑SD increase in stress. If a district is at roughly 60% A’s to begin with, a single standard deviation increase corresponds to a change of about −3 to −4 percentage points.</span>
<span id="cb15-930"><a href="#cb15-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-931"><a href="#cb15-931" aria-hidden="true" tabindex="-1"></a>On the other hand, the SLI effect (β = 0.163) moves in the opposite direction and is of similar magnitude, raising the odds of A by \~18% and typically adding around +3 percentage points when the baseline is near the middle of the probability range. This basically means there is more movement in the middle, less at the extremes, which is pretty expected for logistic models, because probability changes are largest when the baseline is neither very low nor very high. The same logic applies over to Grade B and Grade C. For Grade B, EZI’s positive coefficient means B becomes more common as stress increases, while SLI’s negative coefficient means B recedes as SLI increases. Grade C shows much smaller in the same directions. The best way to understand this is like a see-saw: pushing up stress tilts the distribution away from A and toward B &amp; C, while raising SLI tilts it back toward A again. The tight confidence bands for A and B suggest a stable citywide relationship rather than noise in a handful of districts. While the model is significant for C, the variance and the confidence band is significantly large. Its likely that economic stress does not affect how common Cs are given out.</span>
<span id="cb15-932"><a href="#cb15-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-933"><a href="#cb15-933" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusions</span></span>
<span id="cb15-934"><a href="#cb15-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-935"><a href="#cb15-935" aria-hidden="true" tabindex="-1"></a>The aim for this subset study was to understand how lower economic indicators impact the type of inspection grade given out. Throughout this study, we have gone over multiple significant evidence from the EDA, index construction, and tests all pointing to an answer. That being districts with increasing economic stress tend to show fewer A grades and more B (with some C) grades. This is especially clear when an index is used because people that are unemployed are likely to be in poverty, and if their income is low (i.e. being in the poverty level), their rent burden is likely to be high as well.</span>
<span id="cb15-936"><a href="#cb15-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-937"><a href="#cb15-937" aria-hidden="true" tabindex="-1"></a>There is a solution for this, and its really simple. Districts that have high economic stress should receive both economic and compliance support. Providing training, food safety materials, and small grants for repairs or upgrades to outdated equipment will go a long way in reducing the amount of restaurants not being able to comply with food safety standards. A two to four percentage point shift in grade A might sound like a small amount, but when we live in a city with tens of thousands of restaurants that can add up to a significant number. If the top quarterly of restaurants in the EZI were brought down by even half a standard deviation, there would be a large increase of A's and thus a reductions in B's. It would lead to fewer borderline cases, likely less incidents with food poisoning, and overall help communities' economic and physical health.</span>
<span id="cb15-938"><a href="#cb15-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-939"><a href="#cb15-939" aria-hidden="true" tabindex="-1"></a><span class="fu">## Potential Next steps</span></span>
<span id="cb15-940"><a href="#cb15-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-941"><a href="#cb15-941" aria-hidden="true" tabindex="-1"></a>This study was done with 2 index models and 3 indicator variables. Additional covariates like the highest level of education achieved, Gentrification, or Homes reporting cockroaches could be implemented into these models. Additionally, testing other models like an unsupervised indices (PCA scores) against SLI and EZI could be done to see what model fits best. There could be other questions that stem from this such as how do index effects differ across boroughs, or even districts? Exploring further would help build a solid case to build a policy on supporting restaurants in lower economic areas.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>